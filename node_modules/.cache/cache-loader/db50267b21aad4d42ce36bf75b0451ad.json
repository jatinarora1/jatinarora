{"remainingRequest":"/Users/inmatin/Desktop/anshulrgoyal/node_modules/babel-loader/lib/index.js??ref--12-1!/Users/inmatin/Desktop/anshulrgoyal/node_modules/@docusaurus/mdx-loader/src/index.js??ref--12-2!/Users/inmatin/Desktop/anshulrgoyal/node_modules/@docusaurus/plugin-content-blog/lib/markdownLoader.js??ref--12-3!/Users/inmatin/Desktop/anshulrgoyal/blog/2020-04-19-rust-and-nodejs.md","dependencies":[{"path":"/Users/inmatin/Desktop/anshulrgoyal/blog/2020-04-19-rust-and-nodejs.md","mtime":1597636846610},{"path":"/Users/inmatin/Desktop/anshulrgoyal/.docusaurus/docusaurus-plugin-content-blog/site-blog-2020-04-19-rust-and-nodejs-md-132.json","mtime":1597646785275},{"path":"/Users/inmatin/Desktop/anshulrgoyal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/inmatin/Desktop/anshulrgoyal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/inmatin/Desktop/anshulrgoyal/node_modules/@docusaurus/mdx-loader/src/index.js","mtime":499162500000},{"path":"/Users/inmatin/Desktop/anshulrgoyal/node_modules/@docusaurus/plugin-content-blog/lib/markdownLoader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9leHRlbmRzIGZyb20iL1VzZXJzL2lubWF0aW4vRGVza3RvcC9hbnNodWxyZ295YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2V4dGVuZHMiO2ltcG9ydCBSZWFjdCBmcm9tJ3JlYWN0JztpbXBvcnR7bWR4fWZyb20nQG1keC1qcy9yZWFjdCc7ZXhwb3J0IGNvbnN0IGZyb250TWF0dGVyPXtpZDonbm9kZWpzLXJ1c3QtbWF0Y2gnLHRpdGxlOidSdXN0IGFuZCBOb2RlLmpzOiBBIG1hdGNoIG1hZGUgaW4gaGVhdmVuJyxhdXRob3I6J0Fuc2h1bCBHb3lhbCcsYXV0aG9yX3VybDonaHR0cHM6Ly9naXRodWIuY29tL2Fuc2h1bHJnb3lhbCcsYXV0aG9yX2ltYWdlX3VybDonL2ltZy9hbnNodWwuanBnJyx0YWdzOlsncnVzdCcsJ25vZGVqcyddLGltYWdlOidodHRwczovL3BhcGVyLWF0dGFjaG1lbnRzLmRyb3Bib3guY29tL3NfM0MxMTQzN0E2MUE2NzFERTkzMDUwOUUzNUYyMjNENEE1N0Y5NUY4Qjk4RjI0MDhCRkE3MkVBMzkyMjgzMDZFMl8xNTg3NDYyNzExNTUwX1VudGl0bGVkK2Rlc2lnbi5wbmcnfTtleHBvcnQgY29uc3QgbWV0YWRhdGE9eyJwZXJtYWxpbmsiOiIvYmxvZy9ub2RlanMtcnVzdC1tYXRjaCIsInNvdXJjZSI6IkBzaXRlL2Jsb2cvMjAyMC0wNC0xOS1ydXN0LWFuZC1ub2RlanMubWQiLCJkZXNjcmlwdGlvbiI6IlRhYmxlIG9mIENvbnRlbnRzIiwiZGF0ZSI6IjIwMjAtMDQtMTlUMDA6MDA6MDAuMDAwWiIsInRhZ3MiOlt7ImxhYmVsIjoicnVzdCIsInBlcm1hbGluayI6Ii9ibG9nL3RhZ3MvcnVzdCJ9LHsibGFiZWwiOiJub2RlanMiLCJwZXJtYWxpbmsiOiIvYmxvZy90YWdzL25vZGVqcyJ9XSwidGl0bGUiOiJSdXN0IGFuZCBOb2RlLmpzOiBBIG1hdGNoIG1hZGUgaW4gaGVhdmVuIiwicmVhZGluZ1RpbWUiOjIwLjU4LCJ0cnVuY2F0ZWQiOnRydWUsInByZXZJdGVtIjp7InRpdGxlIjoiQSBiZWdpbm5lcnMgZ3VpZGUgdG8gZ1JQQyB3aXRoIFJ1c3QiLCJwZXJtYWxpbmsiOiIvYmxvZy9ncnBjLXJ1c3QifSwibmV4dEl0ZW0iOnsidGl0bGUiOiJDcmVhdGluZyBGb3JtcyBJbiBSZWFjdCBXaXRoIEZvcm1payBBbmQgWXVwIiwicGVybWFsaW5rIjoiL2Jsb2cvcmVhY3QtZm9ybWlrIn19Oy8qIEBqc3ggbWR4ICovZXhwb3J0IGNvbnN0IHJpZ2h0VG9jPVt7dmFsdWU6J1RhYmxlIG9mIENvbnRlbnRzJyxpZDondGFibGUtb2YtY29udGVudHMnLGNoaWxkcmVuOlt7dmFsdWU6J1RoaXMgYXJ0aWNsZSB3YXMgcHVibGlzaGVkIGF0IExvZyBSb2NrZXQnLGlkOid0aGlzLWFydGljbGUtd2FzLXB1Ymxpc2hlZC1hdC1sb2ctcm9ja2V0JyxjaGlsZHJlbjpbXX1dfSx7dmFsdWU6J1doYXQgaXMgUnVzdD8nLGlkOid3aGF0LWlzLXJ1c3QnLGNoaWxkcmVuOltdfSx7dmFsdWU6J1doYXQgaXMgYSBuYXRpdmUgYWRkb24/JyxpZDond2hhdC1pcy1hLW5hdGl2ZS1hZGRvbicsY2hpbGRyZW46W119LHt2YWx1ZTonV2hlcmUgZG9lcyBSdXN0IGNvbWUgaW4/JyxpZDond2hlcmUtZG9lcy1ydXN0LWNvbWUtaW4nLGNoaWxkcmVuOltdfSx7dmFsdWU6J1NldHRpbmcgdXAgeW91ciBwcm9qZWN0JyxpZDonc2V0dGluZy11cC15b3VyLXByb2plY3QnLGNoaWxkcmVuOltdfSx7dmFsdWU6J1VzaW5nIHRoZSBhZGRvbiBpbiBOb2RlLmpzJyxpZDondXNpbmctdGhlLWFkZG9uLWluLW5vZGVqcycsY2hpbGRyZW46W119LHt2YWx1ZTonQSBkZWVwIGRpdmUgaW50byBOLUFQSScsaWQ6J2EtZGVlcC1kaXZlLWludG8tbi1hcGknLGNoaWxkcmVuOltdfSx7dmFsdWU6J1dvcmtpbmcgd2l0aCBwcm9taXNlcyBhbmQgbGlidXYgdGhyZWFkIHBvb2wnLGlkOid3b3JraW5nLXdpdGgtcHJvbWlzZXMtYW5kLWxpYnV2LXRocmVhZC1wb29sJyxjaGlsZHJlbjpbXX0se3ZhbHVlOidDb25jbHVzaW9uJyxpZDonY29uY2x1c2lvbicsY2hpbGRyZW46W119XTtjb25zdCBsYXlvdXRQcm9wcz17cmlnaHRUb2N9O2NvbnN0IE1EWExheW91dD0id3JhcHBlciI7ZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gTURYQ29udGVudCh7Y29tcG9uZW50cywuLi5wcm9wc30pe3JldHVybiBtZHgoTURYTGF5b3V0LF9leHRlbmRzKHt9LGxheW91dFByb3BzLHByb3BzLHtjb21wb25lbnRzOmNvbXBvbmVudHMsbWR4VHlwZToiTURYTGF5b3V0In0pLG1keCgiaDIiLHsiaWQiOiJ0YWJsZS1vZi1jb250ZW50cyJ9LGBUYWJsZSBvZiBDb250ZW50c2ApLG1keCgib2wiLG51bGwsbWR4KCJsaSIse3BhcmVudE5hbWU6Im9sIn0sYEF2YWlsYWJsZSBNZXRob2RzYCksbWR4KCJsaSIse3BhcmVudE5hbWU6Im9sIn0sYE5hdGl2ZSBBZGRvbnNgKSxtZHgoImxpIix7cGFyZW50TmFtZToib2wifSxgU2V0dGluZyBPZiBQcm9qZWN0YCksbWR4KCJsaSIse3BhcmVudE5hbWU6Im9sIn0sYEEgZGVlcCBkaXZlIGluIE5hcGlgKSxtZHgoImxpIix7cGFyZW50TmFtZToib2wifSxgQ29uY2x1c2lvbmApKSxtZHgoImgzIix7ImlkIjoidGhpcy1hcnRpY2xlLXdhcy1wdWJsaXNoZWQtYXQtbG9nLXJvY2tldCJ9LGBUaGlzIGFydGljbGUgd2FzIHB1Ymxpc2hlZCBhdCBgLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6ImgzIn0seyJocmVmIjoiaHR0cHM6Ly9ibG9nLmxvZ3JvY2tldC5jb20vcnVzdC1hbmQtbm9kZS1qcy1hLW1hdGNoLW1hZGUtaW4taGVhdmVuLyJ9KSxgTG9nIFJvY2tldGApKSxtZHgoInAiLG51bGwsYE5vZGUuanMgaXMgYSB2ZXJ5IHBvcHVsYXIgSmF2YVNjcmlwdCBydW50aW1lIGZvciB3cml0aW5nIGJhY2tlbmQgYXBwbGljYXRpb25zLiBJdHMgZmxleGliaWxpdHkgYW5kIG5vbmJsb2NraW5nIG5hdHVyZSBoYXZlIG1hZGUgaXQgdGhlIHByZW1pZXIgY2hvaWNlIGZvciBBUEkgY29uc3VtcHRpb24uYCksbWR4KCJwIixudWxsLGBTaW5jZSBpdCBpcyBhIHNjcmlwdGluZyBsYW5ndWFnZSwgSmF2YVNjcmlwdCBjYW4gYmUgcHJldHR5IHNsb3cuIEJ1dCB0aGFua3MgdG8gVjggb3B0aW1pemF0aW9uLCBpdCBpcyBmYXN0IGVub3VnaCBmb3IgcHJhY3RpY2FsIGFwcGxpY2F0aW9ucy4gVGhhdCBzYWlkLCBOb2RlLmpzIGlzIG5vdCBnb29kIGZvciBoZWF2eSBsaWZ0aW5nOyBzaW5jZSBpdOKAmXMgc2luZ2xlLXRocmVhZGVkLCBpdCBpcyBkYW5nZXJvdXMgdG8gYmxvY2sgdGhlIG1haW4gdGhyZWFkIGZvciBkb2luZyBsb25nIGNhbGN1bGF0aW9ucy4gVGhhdOKAmXMgd2hlcmUgYCxtZHgoImEiLF9leHRlbmRzKHtwYXJlbnROYW1lOiJwIn0seyJocmVmIjoiaHR0cHM6Ly9ibG9nLmxvZ3JvY2tldC5jb20vbm9kZS1qcy1tdWx0aXRocmVhZGluZy13aGF0LWFyZS13b3JrZXItdGhyZWFkcy1hbmQtd2h5LWRvLXRoZXktbWF0dGVyLTQ4YWIxMDJmOGIxMC8ifSksYHdvcmtlcmApLGAgYCxtZHgoImEiLF9leHRlbmRzKHtwYXJlbnROYW1lOiJwIn0seyJocmVmIjoiaHR0cHM6Ly9ibG9nLmxvZ3JvY2tldC5jb20vbm9kZS1qcy1tdWx0aXRocmVhZGluZy13aGF0LWFyZS13b3JrZXItdGhyZWFkcy1hbmQtd2h5LWRvLXRoZXktbWF0dGVyLTQ4YWIxMDJmOGIxMC8ifSkpLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL2Jsb2cubG9ncm9ja2V0LmNvbS9ub2RlLWpzLW11bHRpdGhyZWFkaW5nLXdoYXQtYXJlLXdvcmtlci10aHJlYWRzLWFuZC13aHktZG8tdGhleS1tYXR0ZXItNDhhYjEwMmY4YjEwLyJ9KSxgdGhyZWFkc2ApLGAgY29tZSBpbi4gTm9kZS5qcyBoYXMgc3VwcG9ydCBmb3Igd29ya2VyIHRocmVhZHMsIHNvIGl0IGNhbiBiZSB1c2VkIHRvIHBlcmZvcm0gbG9uZyBjYWxjdWxhdGlvbnMuYCksbWR4KCJwIixudWxsLGBBcyBncmVhdCBhcyB3b3JrZXIgdGhyZWFkcyBhcmUsIEphdmFTY3JpcHQgaXMgc3RpbGwgc2xvdy4gTW9yZW92ZXIsIHdvcmtlciB0aHJlYWQgYXJlIG5vdCBhdmFpbGFibGUgaW4gYWxsIHN1cHBvcnRlZCBMVFMgdmVyc2lvbnMgb2YgTm9kZS4gRm9ydHVuYXRlbHksIHdlIGNhbiB1c2UgUnVzdCB0byBidWlsZCBhIG5hdGl2ZSBhZGQtb24gZm9yIE5vZGUuanMuIEZGSSBpcyBhbm90aGVyIGFsdGVybmF0aXZlLCBidXQgaXTigJlzIHNsb3dlciB0aGFuIHRoZSBhZGQtb24gYXBwcm9hY2guIFJ1c3QgaXMgYmxhemluZyBmYXN0IGFuZCBoYXMgZmVhcmxlc3MgY29uY3VycmVuY3kuIFNpbmNlIFJ1c3QgaGFzIGEgdmVyeSBzbWFsbCBydW50aW1lIChvciAibm90IHJ1bnRpbWUiKSwgb3VyIGJpbmFyeSBzaXplIHNob3VsZCBhbHNvIGJlIHByZXR0eSBzbWFsbC5gKSxtZHgoImgyIix7ImlkIjoid2hhdC1pcy1ydXN0In0sYFdoYXQgaXMgUnVzdD9gKSxtZHgoInAiLG51bGwsYFJ1c3QgaXMgYSBzeXN0ZW1zIHByb2dyYW1taW5nIGxhbmd1YWdlIGJ5IE1vemlsbGEuIEl0IGNhbiBjYWxsIHRoZSBDIGxpYnJhcnkgYnkgZGVmYXVsdCBhbmQgaW5jbHVkZXMgZmlyc3QtY2xhc3Mgc3VwcG9ydCBmb3IgZXhwb3J0aW5nIGZ1bmN0aW9ucyB0byBDLmApLG1keCgicCIsbnVsbCxgUnVzdCBwcm92aWRlcyB5b3Ugd2l0aCBsb3ctbGV2ZWwgY29udHJvbCBhbmQgaGlnaC1sZXZlbCBlcmdvbm9taWNzLiBJdCBnaXZlcyB5b3UgY29udHJvbCBvZiBtZW1vcnkgbWFuYWdlbWVudCB3aXRob3V0IHRoZSBoYXNzbGUgYXNzb2NpYXRlZCB3aXRoIHRoZXNlIGNvbnRyb2xzLiBJdCBhbHNvIGRlbGl2ZXJzIHplcm8tY29zdCBhYnN0cmFjdGlvbiwgc28geW91IHBheSBmb3Igb25seSB3aGF0IHlvdSB1c2UuYCksbWR4KCJwIixudWxsLGBSdXN0IGNhbiBiZSBjYWxsZWQgaW4gYSBOb2RlLmpzIGNvbnRleHQgdmlhIHZhcmlvdXMgbWV0aG9kcy4gSeKAmXZlIGxpc3RlZCBzb21lIG9mIHRoZSBtb3N0IHdpZGVseSB1c2VkIGJlbG93LmApLG1keCgidWwiLG51bGwsbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYFlvdSBjYW4gdXNlIEZGSSBmcm9tIE5vZGUuanMgYW5kIFJ1c3QsIGJ1dCB0aGlzIGlzIHZlcnkgc2xvd2ApLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LGBZb3UgY2FuIHVzZSBXZWJBc3NlbWJseSB0byBjcmVhdGUgYSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6ImxpIn0sYG5vZGVfbW9kdWxlYCksYCwgYnV0IGFsbCBOb2RlLmpzIGZ1bmN0aW9uYWxpdHkgaXMgbm90IGF2YWlsYWJsZWApLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LGBZb3UgY2FuIHVzZSBuYXRpdmUgYWRkb25zYCkpLG1keCgiaDIiLHsiaWQiOiJ3aGF0LWlzLWEtbmF0aXZlLWFkZG9uIn0sYFdoYXQgaXMgYSBuYXRpdmUgYWRkb24/YCksbWR4KCJwIixudWxsLGBOb2RlLmpzIGFkZG9ucyBhcmUgc2hhcmVkIG9iamVjdHMgd3JpdHRlbiBpbiBDKysgdGhhdCBhcmUgZHluYW1pY2FsbHkgbGlua2VkLiBZb3UgY2FuIGxvYWQgdGhlbSBpbnRvIE5vZGUuanMgdXNpbmcgdGhlIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGByZXF1aXJlKClgKSxgIGZ1bmN0aW9uIGFuZCB1c2UgdGhlbSBhcyBpZiB0aGV5IHdlcmUgb3JkaW5hcnkgTm9kZS5qcyBtb2R1bGVzLiBUaGV5IHByaW1hcmlseSBwcm92aWRlIGFuIGludGVyZmFjZSBiZXR3ZWVuIEphdmFTY3JpcHQgcnVubmluZyBpbiBOb2RlLmpzIGFuZCBDL0MrKyBsaWJyYXJpZXMuYCksbWR4KCJwIixudWxsLGBBIG5hdGl2ZSBhZGRvbiBwcm92aWRlcyBhIHNpbXBsZSBpbnRlcmZhY2UgdG8gd29yayB3aXRoIGFub3RoZXIgYmluYXJ5IGJ5IGxvYWRpbmcgaXQgaW4gVjggcnVudGltZS4gSXQgaXMgdmVyeSBmYXN0IGFuZCBzYWZlIGZvciBtYWtpbmcgY2FsbHMgYWNyb3NzIHRoZSBsYW5ndWFnZXMuIEN1cnJlbnRseSwgTm9kZS5qcyBzdXBwb3J0cyB0d28gdHlwZXMgb2YgYWRkb24gbWV0aG9kczogQysrIGFkZG9ucyBhbmQgTi1BUEkgQysrL0MgYWRkb25zLmApLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxgQysrIEFkZG9uc2ApKSxtZHgoInAiLG51bGwsYEEgQysrIGFkZG9uIGlzIGFuIG9iamVjdCB0aGF0IGNhbiBiZSBtb3VudGVkIGJ5IE5vZGUuanMgYW5kIHVzZWQgaW4gdGhlIHJ1bnRpbWUuIFNpbmNlIEMrKyBpcyBhIGNvbXBpbGVkIGxhbmd1YWdlLCB0aGVzZSBhZGRvbnMgYXJlIHZlcnkgZmFzdC4gQysrIGhhcyBhIHdpZGUgYXJyYXkgb2YgcHJvZHVjdGlvbi1yZWFkeSBsaWJyYXJpZXMgdGhhdCBjYW4gYmUgdXNlZCB0byBleHBhbmQgdGhlIE5vZGUuanMgZWNvc3lzdGVtLiBNYW55IHBvcHVsYXIgbGlicmFyaWVzIHVzZSBuYXRpdmUgYWRkb25zIHRvIGltcHJvdmUgcGVyZm9ybWFuY2UgYW5kIGNvZGUgcXVhbGl0eS5gKSxtZHgoInAiLG51bGwsbWR4KCJzdHJvbmciLHtwYXJlbnROYW1lOiJwIn0sYE4tQVBJYCksYCBgLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LGBDKysvQyBBZGRvbnNgKSksbWR4KCJwIixudWxsLGBUaGUgbWFpbiBwcm9ibGVtIHdpdGggQysrIGFkZG9ucyBpcyB0aGF0IHlvdSBuZWVkIHRvIGNvbXBpbGUgdGhlbSBhZ2FpbiB3aXRoIGV2ZXJ5IGNoYW5nZSB0byB1bmRlcmx5aW5nIEphdmFTY3JpcHQgcnVudGltZS4gSXQgY2F1c2VzIGEgcHJvYmxlbSB3aXRoIG1haW50YWluaW5nIHRoZSBhZGRvbi4gTi1BUEkgdHJpZXMgdG8gZWxpbWluYXRlIHRoaXMsIGJ5IGludHJvZHVjaW5nIGEgc3RhbmRhcmQgQUJJIChBcHBsaWNhdGlvbiBCaW5hcnkgSW50ZXJmYWNlKS4gVGhlIEMgaGVhZGVyIGZpbGUgcmVtYWlucyBiYWNrd2FyZCBjb21wYXRpYmxlLiBUaGF0IG1lYW5zIHRoZSBhZGRvbiBjb21waWxlZCBmb3IgYSBwYXJ0aWN1bGFyIHZlcnNpb24gb2YgTm9kZS5qcywgY2FuIGJlIHVzZWQgd2l0aCBhbnkgdmVyc2lvbiBncmVhdGVyIHRoYW4gdGhlIHZlcnNpb24gb2YgTm9kZS5qcyBpdCB3YXMgY29tcGlsZWQgZm9yLiBZb3Ugd291bGQgdXNlIHRoaXMgbWV0aG9kIHRvIGltcGxlbWVudCB5b3VyIGFkZG9uLmApLG1keCgiaDIiLHsiaWQiOiJ3aGVyZS1kb2VzLXJ1c3QtY29tZS1pbiJ9LGBXaGVyZSBkb2VzIFJ1c3QgY29tZSBpbj9gKSxtZHgoInAiLG51bGwsYFJ1c3QgY2FuIG1pbWljIHRoZSBiZWhhdmlvciBvZiBhIEMgbGlicmFyeS4gSW4gb3RoZXIgd29yZHMsIGl0IGV4cG9ydHMgdGhlIGZ1bmN0aW9uIGluIGEgZm9ybWF0IHRoZSBDIGNhbiB1bmRlcnN0YW5kIGFuZCB1c2UuIFJ1c3QgY2FsbHMgdGhlIEMgZnVuY3Rpb24gdG8gYWNjZXNzIGFuZCB1c2UgQVBJcyBwcm92aWRlZCBieSB0aGUgTm9kZS5qcy4gVGhlc2UgQVBJcyBwcm92aWRlIG1ldGhvZHMgZm9yIGNyZWF0aW5nIEphdmFTY3JpcHQgc3RyaW5ncywgYXJyYXlzLCBudW1iZXJzLCBlcnJvciwgb2JqZWN0cywgZnVuY3Rpb25zLCBhbmQgbW9yZS4gQnV0IHdlIG5lZWQgdG8gdGVsbCBSdXN0IHdoYXQgdGhlc2UgZXh0ZXJuYWwgZnVuY3Rpb25zLCBzdHJ1Y3RzLCBwb2ludGVycywgZXRjLiBsb29rIGxpa2UuYCksbWR4KCJwcmUiLG51bGwsbWR4KCJjb2RlIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicHJlIn0se30pLGAjW3JlcHIoQyldCnN0cnVjdCBNeVJ1c3RTdHJ1Y3QgewogICAgYTogaTMyLAp9CmV4dGVybiAiQyIgZm4gcnVzdF93b3JsZF9jYWxsYmFjayh0YXJnZXQ6ICptdXQgUnVzdE9iamVjdCwgYTogaTMyKSB7CiAgICBwcmludGxuISgiRnVuY3Rpb24gaXMgY2FsbGVkIGZyb20gQyB3b3JsZCIsIGEpOwogICAgdW5zYWZlIHsKICAgICAgICAvLyBEbyBzb21ldGhpbmcgb24gcnVzdCBzdHJ1Y3QKICAgICAgICAoKnRhcmdldCkuYSA9IGE7CiAgICB9Cn0KZXh0ZXJuIHsKICAgZm4gcmVnaXN0ZXJfY2FsbGJhY2sodGFyZ2V0OiAqbXV0IE15UnVzdFN0cnVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgY2I6IGV4dGVybiBmbigqbXV0IE15UnVzdFN0cnVjdCwgaTMyKSkgLT4gaTMyOwogICBmbiB0cmlnZ2VyX2NhbGxiYWNrKCk7Cn0KYCkpLG1keCgicCIsbnVsbCxgUnVzdCBsYXlzIGRvd24gdGhlIHN0cnVjdHMgaW4gbWVtb3J5IGRpZmZlcmVudGx5LCBzbyB3ZSBuZWVkIHRvIHRlbGwgaXQgdG8gdXNlIHRoZSBzdHlsZSBDIHVzZXMuIEl0IHdvdWxkIGEgcGFpbiB0byBjcmVhdGUgdGhlc2UgZnVuY3Rpb25zIGJ5IGhhbmQsIHNvIHdl4oCZbGwgdXNlIGEgY3JhdGUgY2FsbGVkIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBub2RlanMtc3lzYCksYCB0aGF0IHVzZXMgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYGJpbmRnZW5gKSxgIHRvIGNyZWF0ZSBhIG5pY2UgZGVmaW5pdGlvbiBmb3IgTi1BUEkuYCksbWR4KCJwIixudWxsLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgYlxgXGBpbmRnZW5gKSxgIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVzIFJ1c3QgRkZJIGJpbmRpbmdzIHRvIEMgYW5kIEMrKyBsaWJyYXJpZXMuYCksbWR4KCJwIixudWxsLGBOb3RlOiBUaGVyZSB3aWxsIGEgbG90IG9mIHVuc2FmZSBjb2RlIGFoZWFkLCBtb3N0bHkgZXh0ZXJuYWwgZnVuY3Rpb24gY2FsbHMuYCksbWR4KCJwIixudWxsLG1keCgiaW1nIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicCJ9LHsic3JjIjoiaHR0cHM6Ly9kZXYtdG8tdXBsb2Fkcy5zMy5hbWF6b25hd3MuY29tL2kvNHJnYm5vaGc4bHkzaGI1ZzF2YWMuZ2lmIiwiYWx0IjoiSm9rZXIifSkpKSxtZHgoImgyIix7ImlkIjoic2V0dGluZy11cC15b3VyLXByb2plY3QifSxgU2V0dGluZyB1cCB5b3VyIHByb2plY3RgKSxtZHgoInAiLG51bGwsYEZvciB0aGlzIHR1dG9yaWFsLCB5b3UgbXVzdCBoYXZlIGAsbWR4KCJhIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicCJ9LHsiaHJlZiI6Imh0dHBzOi8vbm9kZWpzLm9yZy8ifSksYE5vZGUuanNgKSxgIGFuZCBgLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL3d3dy5ydXN0LWxhbmcub3JnLyJ9KSxgUnVzdGApLGAgaW5zdGFsbGVkIG9uIHlvdXIgc3lzdGVtLCB3aXRoIGAsbWR4KCJhIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicCJ9LHsiaHJlZiI6Imh0dHBzOi8vZ2l0aHViLmNvbS9ydXN0LWxhbmcvY2FyZ28vIn0pLGBDYXJnb2ApLGAgYW5kIGAsbWR4KCJhIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicCJ9LHsiaHJlZiI6Imh0dHBzOi8vd3d3Lm5wbWpzLmNvbS8ifSksYE5QTWApLGAuIEkgd291bGQgc3VnZ2VzdCB1c2luZyBgLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL3J1c3R1cC5ycy8ifSksYFJ1c3R1cGApLGAgdG8gaW5zdGFsbCBSdXN0IGFuZCBgLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL2dpdGh1Yi5jb20vbnZtLXNoL252bSJ9KSxgbnZtYCksYCBmb3IgTm9kZS5qcy5gKSxtZHgoInAiLG51bGwsYENyZWF0ZSBhIGRpcmVjdG9yeSBuYW1lZCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgcnVzdC1hZGRvbmApLGAgYW5kIGluaXRpYWxpemUgYSBuZXcgbnBtIHByb2plY3QgYnkgcnVubmluZyBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbnBtIGluaXRgKSxgLiBOZXh0LCBpbml0IGEgY2FyZ28gcHJvamVjdCBjYWxsZWQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYGNhcmdvIGluaXQgLS1saWJgKSxgLiBZb3VyIHByb2plY3QgZGlyZWN0b3J5IHNob3VsZCBsb29rIGxpa2UgdGhpczpgKSxtZHgoInByZSIsbnVsbCxtZHgoImNvZGUiLF9leHRlbmRzKHtwYXJlbnROYW1lOiJwcmUifSx7fSksYOKUnOKUgOKUgCBDYXJnby50b21sCuKUnOKUgOKUgCBwYWNrYWdlLmpzb24K4pSU4pSA4pSAIHNyYwogICAg4pSU4pSA4pSAIGxpYi5ycwpgKSksbWR4KCJwIixudWxsLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LGBDb25maWd1cmluZyBSdXN0IHRvIGNvbXBpbGUgdG8gdGhlIGFkZG9uYCkpLG1keCgicCIsbnVsbCxgV2UgbmVlZCBSdXN0IHRvIGNvbXBpbGUgdG8gYSBkeW5hbWljIEMgbGlicmFyeSBvciBvYmplY3QuIENvbmZpZ3VyZSBjYXJnbyB0byBjb21waWxlIHRvIHRoZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgLnNvYCksYCBmaWxlIG9uIExpbnV4LCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgLmR5bGliYCksYCBvbiBPUyBYLCBhbmQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYC5kbGxgKSxgIG9uIFdpbmRvd3MuIFJ1c3QgY2FuIHByb2R1Y2UgbWFueSBkaWZmZXJlbnQgdHlwZXMgb2YgbGlicmFyaWVzIHVzaW5nIFJ1c3RjIGZsYWdzIG9yIENhcmdvLmApLG1keCgicHJlIixudWxsLG1keCgiY29kZSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InByZSJ9LHt9KSxgW3BhY2thZ2VdCm5hbWUgPSAicnVzdC1hZGRvbiIKdmVyc2lvbiA9ICIwLjEuMCIKYXV0aG9ycyA9IFsiQW5zaHVsIEdveWFsIDxhbnNodWxnb2VsMTUxOTk5QGdtYWlsLmNvbT4iXQplZGl0aW9uID0gIjIwMTgiCiMgU2VlIG1vcmUga2V5cyBhbmQgdGhlaXIgZGVmaW5pdGlvbnMgYXQgaHR0cHM6Ly9kb2MucnVzdC1sYW5nLm9yZy9jYXJnby9yZWZlcmVuY2UvbWFuaWZlc3QuaHRtbAoKW2xpYl0KY3JhdGUtdHlwZT1bImNkeWxpYiJdCgpbZGVwZW5kZW5jaWVzXQpub2RlanMtc3lzID0gIjAuMi4wIgpgKSksbWR4KCJwIixudWxsLGBUaGUgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYGxpYmApLGAga2V5IHByb3ZpZGVzIG9wdGlvbnMgdG8gY29uZmlndXJlIFJ1c3RjLiBUaGUgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hbWVgKSxgIGtleSBnaXZlcyB0aGUgbGlicmFyeSBuYW1lIHRvIHRoZSBzaGFyZWQgb2JqZWN0IGluIHRoZSBmb3JtIG9mIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBsaWJ7bmFtZX1gKSxgLCB3aGlsZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgdHlwZWApLGAgcHJvdmlkZXMgdGhlIHR5cGUgb2YgbGlicmFyeSBpdCBzaG91bGQgYmUgY29tcGlsZWQgdG8g4oCUIGUuZy4sIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBjZHlsaWJgKSxgLCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgcmxpYmApLGAsIGV0Yy4gYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYGNkeWxpYmApLGAgY3JlYXRlcyBhIGR5bmFtaWNhbGx5IGxpbmtlZCBDIGxpYnJhcnkuIFRoaXMgc2hhcmVkIG9iamVjdCBiZWhhdmVzIGxpa2UgYSBDIGxpYnJhcnkuYCksbWR4KCJwIixudWxsLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LGBTdGFydGluZyB3aXRoYCksYCBgLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LGBOLUFQSWApKSxtZHgoInAiLG51bGwsYExldOKAmXMgY3JlYXRlIG91ciBOLUFQSSBsaWJyYXJ5LiBXZSBuZWVkIHRvIGFkZCBhIGRlcGVuZGVuY3kuIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBub2RlanMtc3lzYCksYCBwcm92aWRlcyB1cyB3aXRoIHRoZSBiaW5kaW5nIHJlcXVpcmVkIGZvciBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaS1oZWFkZXJgKSxgIGZpbGVzLiBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV9yZWdpc3Rlcl9tb2R1bGVfdjFgKSxgIGlzIHRoZSBlbnRyeSBwb2ludCBmb3IgdGhlIGFkZG9uLiBgLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL25vZGVqcy5vcmcvYXBpL24tYXBpLmh0bWwjbl9hcGlfbW9kdWxlX3JlZ2lzdHJhdGlvbiJ9KSxgTmApLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL25vZGVqcy5vcmcvYXBpL24tYXBpLmh0bWwjbl9hcGlfbW9kdWxlX3JlZ2lzdHJhdGlvbiJ9KSxgLWApLG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7ImhyZWYiOiJodHRwczovL25vZGVqcy5vcmcvYXBpL24tYXBpLmh0bWwjbl9hcGlfbW9kdWxlX3JlZ2lzdHJhdGlvbiJ9KSxgQVBJIGRvY3VtZW50YXRpb25gKSxgIHJlY29tbWVuZHMgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYE4tQVBJXGBcYF9NT0RVTEVfSU5JVGApLGAgbWFjcm8gZm9yIG1vZHVsZSByZWdpc3RyYXRpb24gd2hpY2ggY29tcGlsZXMgdG8gYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfcmVnaXN0ZXJfbW9kdWxlX3YxYCksYCBmdW5jdGlvbi5gKSxtZHgoInAiLG51bGwsYE5vZGUuanMgY2FsbHMgdGhpcyBmdW5jdGlvbiBhbmQgcHJvdmlkZXMgaXQgd2l0aCBhbiBvcGFxdWUgcG9pbnRlciBjYWxsZWQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfZW52YCksYCwgd2hpY2ggcmVmZXJzIHRvIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBtb2R1bGUgaW4gSmF2YVNjcmlwdCBydW50aW1lLCBhbmQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfdmFsdWVgKSxgLiBUaGUgbGF0dGVyIGlzIGFub3RoZXIgb3BhcXVlIHBvaW50ZXIgdGhhdCByZXByZXNlbnRzIGEgSmF2YVNjcmlwdCB2YWx1ZSwgd2hpY2gsIGluIHJlYWxpdHkgaXMgYW4gb2JqZWN0IGtub3duIGFzIGFuIGV4cG9ydC4gVGhlc2UgZXhwb3J0cyBhcmUgdGhlIHNhbWUgYXMgdGhvc2UgdGhlIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGByZXF1aXJlYCksYCBmdW5jdGlvbiBwcm92aWRlcyB0byB0aGUgTm9kZS5qcyBtb2R1bGVzIGluIEphdmFTY3JpcHQuYCksbWR4KCJwcmUiLG51bGwsbWR4KCJjb2RlIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicHJlIn0se30pLGB1c2Ugbm9kZWpzX3N5czo6e25hcGlfY3JlYXRlX3N0cmluZ191dGY4LCBuYXBpX2VudiwgbmFwaV9zZXRfbmFtZWRfcHJvcGVydHksIG5hcGlfdmFsdWV9Owp1c2Ugc3RkOjpmZmk6OkNTdHJpbmc7CiNbbm9fbWFuZ2xlXQpwdWIgdW5zYWZlIGV4dGVybiAiQyIgZm4gbmFwaV9yZWdpc3Rlcl9tb2R1bGVfdjEoCiAgICBlbnY6IG5hcGlfZW52LAogICAgZXhwb3J0czogbmFwaV92YWx1ZSwKKSAtPiBub2RlanNfc3lzOjpuYXBpX3ZhbHVlIHsKLy8gY3JlYXRpbmcgYSBDIHN0cmluZwogICAgbGV0IGtleSA9IENTdHJpbmc6Om5ldygiaGVsbG8iKS5leHBlY3QoIkNTdHJpbmc6Om5ldyBmYWlsZWQiKTsKLy8gY3JlYXRpbmcgYSBtZW1vcnkgbG9jYXRpb24gd2hlcmUgdGhlIHBvaW50ZXIgdG8gbmFwaV92YWx1ZSB3aWxsIGJlIHNhdmVkCiAgICBsZXQgbXV0IGxvY2FsOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwovLyBjcmVhdGluZyBhIEMgc3RyaW5nCiAgICBsZXQgdmFsdWUgPSBDU3RyaW5nOjpuZXcoIndvcmxkISIpLmV4cGVjdCgiQ1N0cmluZzo6bmV3IGZhaWxlZCIpOwovLyBjcmVhdGluZyBuYXBpX3ZhbHVlIGZvciB0aGUgc3RyaW5nCiAgICBuYXBpX2NyZWF0ZV9zdHJpbmdfdXRmOChlbnYsIHZhbHVlLmFzX3B0cigpLCA2LCAmbXV0IGxvY2FsKTsKLy8gc2V0dGluZyB0aGUgc3RyaW5nIG9uIHRoZSBleHBvcnRzIG9iamVjdAogICAgbmFwaV9zZXRfbmFtZWRfcHJvcGVydHkoZW52LCBleHBvcnRzLCBrZXkuYXNfcHRyKCksIGxvY2FsKTsKLy8gcmV0dXJuaW5nIHRoZSBvYmplY3QKICAgIGV4cG9ydHMKfQpgKSksbWR4KCJwIixudWxsLGBSdXN0IHJlcHJlc2VudHMgb3duZWQgc3RyaW5ncyB3aXRoIHRoZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgU1xgXGB0cmluZ2ApLGAgdHlwZSBhbmQgYm9ycm93ZWQgc2xpY2VzIG9mIHN0cmluZ3Mgd2l0aCB0aGUgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYHN0cmApLGAgcHJpbWl0aXZlLiBCb3RoIGFyZSBhbHdheXMgaW4gVVRGLTggZW5jb2RpbmcgYW5kIG1heSBjb250YWluIG51bGwgYnl0ZXMgaW4gdGhlIG1pZGRsZS4gSWYgeW91IGxvb2sgYXQgdGhlIGJ5dGVzIHRoYXQgbWFrZSB1cCB0aGUgc3RyaW5nLCB0aGVyZSBtYXkgYmUgYSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgXFwwYCksYCBhbW9uZyB0aGVtLiBCb3RoIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBTdHJpbmdgKSxgIGFuZCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgc3RyYCksYCBzdG9yZSB0aGVpciBsZW5ndGggZXhwbGljaXRseTsgdGhlcmUgYXJlIG5vIG51bGwgdGVybWluYXRvcnMgYXQgdGhlIGVuZCBvZiBzdHJpbmdzIGxpa2UgQyBzdHJpbmdzLmApLG1keCgicCIsbnVsbCxgUnVzdCBzdHJpbmdzIGFyZSB2ZXJ5IGRpZmZlcmVudCBmcm9tIHRoZSBvbmVzIGluIEMsIHNvIHdlIG5lZWQgdG8gY2hhbmdlIG91ciBSdXN0IHN0cmluZ3MgdG8gQyBzdHJpbmdzIGJlZm9yZSB3ZSBjYW4gdXNlIHRoZW4gd2l0aCBOLUFQSSBmdW5jdGlvbnMuIFNpbmNlIGV4cG9ydHMgaXMgYW4gb2JqZWN0IHJlcHJlc2VudGVkIGJ5IGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBleHBvcnRzYCksYCwgd2UgY2FuIGFkZCBmdW5jdGlvbnMsIHN0cmluZ3MsIGFycmF5cywgb3IgYW55IG90aGVyIEphdmFTY3JpcHQgb2JqZWN0cyBhcyBrZXktdmFsdWUgcGFpcnMuYCksbWR4KCJwIixudWxsLGBUbyBhZGQgYSBrZXkgdG8gYSBKYXZhU2NyaXB0IG9iamVjdCwgeW91IGNhbiB1c2UgYSBtZXRob2QgcHJvdmlkZWQgYnkgdGhlIE4tQVBJIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX3NldF9uYW1lZF9wcm9wZXJ0eWApLGAuIFRoaXMgZnVuY3Rpb24gdGFrZXMgdGhlIG9iamVjdCB0byB3aGljaCB3ZSB3YW50IHRvIGFkZCBhIHByb3BlcnR5OyBhIHBvaW50ZXIgdG8gYSBzdHJpbmcgdGhhdCB3aWxsIGJlIHVzZWQgYXMgdGhlIGtleSBmb3Igb3VyIHByb3BlcnR5OyB0aGUgcG9pbnRlciB0byB0aGUgSmF2YVNjcmlwdCB2YWx1ZSwgd2hpY2ggY2FuIGJlIGEgc3RyaW5nLCBhcnJheSwgZXRjLjsgYW5kIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2VudmApLGAsIHdoaWNoIGFjdHMgYW4gYW5jaG9yIGJldHdlZW4gUnVzdCBhbmQgTm9kZS5qcy5gKSxtZHgoInAiLG51bGwsYFlvdSBjYW4gdXNlIE4tQVBJIGZ1bmN0aW9ucyB0byBjcmVhdGUgYW55IEphdmFTY3JpcHQgdmFsdWUuIEZvciBleGFtcGxlLCB3ZSB1c2VkIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2NyZWF0ZV9zdHJpbmdfdXRmOGApLGAgaGVyZSB0byBjcmVhdGUgYSBzdHJpbmcuIFdlIHBhc3NlZCBpbiB0aGUgZW52aXJvbm1lbnQgYSBwb2ludGVyIHRvIHRoZSBzdHJpbmcsIHRoZSBsZW5ndGggb2Ygc3RyaW5nLCBhbmQgYSBwb2ludGVyIHRvIGFuIGVtcHR5IG1lbW9yeSBsb2NhdGlvbiB3aGVyZSBpdCBjYW4gd3JpdGUgdGhlIHBvaW50ZXIgdG8gdGhlIG5ld2x5IGNyZWF0ZWQgdmFsdWUuIEFsbCB0aGlzIGNvZGUgaXMgdW5zYWZlIGJlY2F1c2UgaXQgaW5jbHVkZXMgbWFueSBjYWxscyB0byBleHRlcm5hbCBmdW5jdGlvbnMgd2hlcmUgdGhlIGNvbXBpbGVyIGNhbm5vdCBwcm92aWRlIFJ1c3QgZ3VhcmFudGVlcy4gSW4gdGhlIGVuZCwgd2UgcmV0dXJuZWQgdGhlIG1vZHVsZSB0aGF0IHdhcyBwcm92aWRlZCB0byB1cyBieSBzZXR0aW5nIGEgcHJvcGVydHkgb24gaXQgd2l0aCB0aGUgdmFsdWUgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYHdvcmxkIWApLGAuYCksbWR4KCJwIixudWxsLGBJdOKAmXMgaW1wb3J0YW50IHRvIHVuZGVyc3RhbmQgdGhhdCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbm9kZWpzLXN5c2ApLGAganVzdCBwcm92aWRlcyB0aGUgcmVxdWlyZWQgZGVmaW5pdGlvbnMgZm9yIHRoZSBmdW5jdGlvbiB5b3XigJlyZSB1c2luZywgbm90IHRoZWlyIGltcGxlbWVudGF0aW9uLiBOLUFQSSBpbXBsZW1lbnRhdGlvbiBpcyBpbmNsdWRlZCB3aXRoIE5vZGUuanMgYW5kIHlvdSBjYWxsIGl0IGZyb20geW91ciBSdXN0IGNvZGUuYCksbWR4KCJoMiIseyJpZCI6InVzaW5nLXRoZS1hZGRvbi1pbi1ub2RlanMifSxgVXNpbmcgdGhlIGFkZG9uIGluIE5vZGUuanNgKSxtZHgoInAiLG51bGwsYFRoZSBuZXh0IHN0ZXAgaXMgdG8gYWRkIGEgbGlua2luZyBjb25maWd1cmF0aW9uIGZvciBkaWZmZXJlbnQgb3BlcmF0aW5nIHN5c3RlbXMsIHRoZW4geW91IGNhbiBjb21waWxlIGl0LmApLG1keCgicCIsbnVsbCxgQ3JlYXRlIGEgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYGJ1aWxkLnJzYCksYCBmaWxlIHRvIGFkZCBhIGZldyBjb25maWd1cmF0aW9uIGZsYWdzIGZvciBsaW5raW5nIHRoZSBOLUFQSSBmaWxlcyBvbiBkaWZmZXJlbnQgb3BlcmF0aW5nIHN5c3RlbXMuYCksbWR4KCJwcmUiLG51bGwsbWR4KCJjb2RlIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicHJlIn0se30pLGBmbiBtYWluKCkgewogICAgcHJpbnRsbiEoImNhcmdvOnJ1c3RjLWNkeWxpYi1saW5rLWFyZz0tdW5kZWZpbmVkIik7CiAgICBpZiBjZmchKHRhcmdldF9vcyA9ICJtYWNvcyIpIHsKICAgICAgICBwcmludGxuISgiY2FyZ286cnVzdGMtY2R5bGliLWxpbmstYXJnPWR5bmFtaWNfbG9va3VwIik7CiAgICB9Cn0KYCkpLG1keCgicCIsbnVsbCxgWW91ciBkaXJlY3Rvcnkgc2hvdWxkIGxvb2sgbGlrZSB0aGlzOmApLG1keCgicHJlIixudWxsLG1keCgiY29kZSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InByZSJ9LHt9KSxg4pSc4pSA4pSAIGJ1aWxkLnJzCuKUnOKUgOKUgCBDYXJnby5sb2NrCuKUnOKUgOKUgCBDYXJnby50b21sCuKUnOKUgOKUgCBpbmRleC5ub2RlCuKUnOKUgOKUgCBwYWNrYWdlLmpzb24K4pSc4pSA4pSAIHNyYwogICAg4pSU4pSA4pSAIGxpYi5ycwpgKSksbWR4KCJwIixudWxsLGBOb3cgeW91IG5lZWQgdG8gY29tcGlsZSB5b3VyIFJ1c3QgYWRkb24uIFlvdSBjYW4gZG8gc28gcHJldHR5IGVhc2lseSB1c2luZyB0aGUgc2ltcGxlIGNvbW1hbmQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYGNhcmdvIGJ1aWxkIC0tcmVsZWFzZWApLGAuIFRoaXMgd2lsbCB0YWtlIHNvbWUgdGltZSBvbiB0aGUgZmlyc3QgcnVuLmApLG1keCgicCIsbnVsbCxgQWZ0ZXIgeW91ciBtb2R1bGUgaXMgY29tcGlsZWQsIGNyZWF0ZSBhIGNvcHkgb2YgdGhpcyBiaW5hcnkgZnJvbSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgLi90YXJnZXQvcmVsZWFzZS9saWJuYXRpdmUuc29gKSxgIHRvIHlvdXIgcm9vdCBkaXJlY3RvcnkgYW5kIHJlbmFtZSBpdCBhcyBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgaW5kZXgubm9kZWApLGAuIFRoZSBiaW5hcnkgY3JlYXRlZCBieSB0aGUgY2FyZ28gbWF5IGhhdmUgYSBkaWZmZXJlbnQgZXh0ZW5zaW9uIG9yIG5hbWUsIGRlcGVuZGluZyBvbiB5b3VyIGNyYXRlIHNldHRpbmcgYW5kIG9wZXJhdGluZyBzeXN0ZW0uYCksbWR4KCJwIixudWxsLGBOb3cgeW91IGNhbiByZXF1aXJlIHRoZSBmaWxlIGluIE5vZGUuanMgYW5kIHVzZSBpdC4gWW91IGNhbiBhbHNvIHVzZSBpdCBpbiBhIHNjcmlwdC4gRm9yIGV4YW1wbGU6YCksbWR4KCJwcmUiLG51bGwsbWR4KCJjb2RlIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicHJlIn0se30pLGBsZXQgYWRkb249cmVxdWlyZSgnLi9pbmRleC5ub2RlJyk7CmNvbnNvbGUubG9nKGFkZG9uLmhlbGxvKTsKYCkpLG1keCgicCIsbnVsbCxtZHgoImltZyIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7InNyYyI6Imh0dHBzOi8vZGV2LXRvLXVwbG9hZHMuczMuYW1hem9uYXdzLmNvbS9pL296Ynh3d21tNjY4MG96OTd2NWRzLnBuZyIsImFsdCI6IkV4YW1wbGUifSkpKSxtZHgoInAiLG51bGwsYE5leHQsIHdl4oCZbGwgbW92ZSBvbiB0byBjcmVhdGluZyBmdW5jdGlvbnMsIGFycmF5cywgYW5kIHByb21pc2VzIGFuZCB1c2luZyBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbGlidXYgdGhyZWFkLXBvb2xgKSxgIHRvIHBlcmZvcm0gaGVhdnkgdGFza3Mgd2l0aG91dCBibG9ja2luZyB0aGUgbWFpbiB0aHJlYWQuYCksbWR4KCJoMiIseyJpZCI6ImEtZGVlcC1kaXZlLWludG8tbi1hcGkifSxgQSBkZWVwIGRpdmUgaW50byBOLUFQSWApLG1keCgicCIsbnVsbCxgTm93IHlvdSBrbm93IGhvdyB0byBpbXBsZW1lbnQgY29tbW9uIHBhdHRlcm5zIHVzaW5nIE4tQVBJIGFuZCBSdXN0LiBBIHZlcnkgY29tbW9uIHBhdHRlcm4gaXMgdGhlIGV4cG9ydCBmdW5jdGlvbiwgd2hpY2ggY2FuIGJlIGNhbGxlZCBieSB0aGUgdXNlciBvZiB0aGUgbGlicmFyeSBvciBOb2RlIG1vZHVsZS4gTGV04oCZcyBzdGFydCBieSBjcmVhdGluZyBhIGZ1bmN0aW9uLmApLG1keCgicCIsbnVsbCxgWW91IHNob3VsZCB1c2UgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfY3JlYXRlX2Z1bmN0aW9uYCksYCB0byBjcmVhdGUgeW91ciBmdW5jdGlvbnMgc28gdGhhdCB5b3UgY2FuIHVzZSB0aGVtIGZyb20gTm9kZS5qcy4gWW91IGNhbiBhZGQgdGhlc2UgZnVuY3Rpb25zIGFzIGEgcHJvcGVydHkgdG8gZXhwb3J0cyB0byB1c2UgZnJvbSBOb2RlLmpzLmApLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxgQ3JlYXRpbmcgYSBmdW5jdGlvbmApKSxtZHgoInAiLG51bGwsYEphdmFTY3JpcHQgZnVuY3Rpb25zIGFyZSBhbHNvIHJlcHJlc2VudGVkIGJ5IHRoZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV92YWx1ZWApLGAgcG9pbnRlci4gQSBOLUFQSSBmdW5jdGlvbiBpcyBwcmV0dHkgZWFzeSB0byBjcmVhdGUgYW5kIHVzZS5gKSxtZHgoInByZSIsbnVsbCxtZHgoImNvZGUiLF9leHRlbmRzKHtwYXJlbnROYW1lOiJwcmUifSx7fSksYHVzZSBub2RlanNfc3lzOjp7CiAgICBuYXBpX2NhbGxiYWNrX2luZm8sIG5hcGlfY3JlYXRlX2Z1bmN0aW9uLCBuYXBpX2NyZWF0ZV9zdHJpbmdfdXRmOCwgbmFwaV9lbnYsCiAgICBuYXBpX3NldF9uYW1lZF9wcm9wZXJ0eSwgbmFwaV92YWx1ZSwKfTsKdXNlIHN0ZDo6ZmZpOjpDU3RyaW5nOwpwdWIgdW5zYWZlIGV4dGVybiAiQyIgZm4gc2F5X2hlbGxvKGVudjogbmFwaV9lbnYsIF9pbmZvOiBuYXBpX2NhbGxiYWNrX2luZm8pIC0+IG5hcGlfdmFsdWUgewovLyBjcmVhdGluZyAgYSBqYXZhc3RyaW5nIHN0cmluZwogICAgbGV0IG11dCBsb2NhbDogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgIGxldCBwID0gQ1N0cmluZzo6bmV3KCJIZWxsbyBmcm9tIHJ1c3QiKS5leHBlY3QoIkNTdHJpbmc6Om5ldyAgICBmYWlsZWQiKTsKICAgIG5hcGlfY3JlYXRlX3N0cmluZ191dGY4KGVudiwgcC5hc19wdHIoKSwgMTMsICZtdXQgbG9jYWwpOwovLyByZXR1cm5pbmcgdGhlIGphdmFzY3JpcHQgc3RyaW5nCiAgICBsb2NhbAp9CiNbbm9fbWFuZ2xlXQpwdWIgdW5zYWZlIGV4dGVybiAiQyIgZm4gbmFwaV9yZWdpc3Rlcl9tb2R1bGVfdjEoCiAgICBlbnY6IG5hcGlfZW52LAogICAgZXhwb3J0czogbmFwaV92YWx1ZSwKKSAtPiBub2RlanNfc3lzOjpuYXBpX3ZhbHVlIHsKLy8gY3JlYXRpbmcgYSBDIFN0cmluZwogICAgbGV0IHAgPSBDU3RyaW5nOjpuZXcoIm15RnVuYyIpLmV4cGVjdCgiQ1N0cmluZzo6bmV3IGZhaWxlZCIpOwovLyBjcmVhdGluZyBhIGxvY2F0aW9uIHdoZXJlIHBvaW50ZXIgdG8gbmFwaV92YWx1ZSBiZSB3cml0dGVuCiAgICBsZXQgbXV0IGxvY2FsOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwogICAgbmFwaV9jcmVhdGVfZnVuY3Rpb24oCiAgICAgICAgZW52LAovLyBwb2ludGVyIHRvIGZ1bmN0aW9uIG5hbWUKICAgICAgICBwLmFzX3B0cigpLAovLyBsZW5ndGggb2YgZnVuY3Rpb24gbmFtZQogICAgICAgIDUsCi8vIHJ1c3QgZnVuY3Rpb24KICAgICAgICBTb21lKHNheV9oZWxsbyksCi8vIGNvbnRleHQgd2hpY2ggY2FuIGJlIGFjY2Vzc2VkIGJ5IHRoZSBydXN0IGZ1bmN0aW9uCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCi8vIG91dHB1dCBuYXBpX3ZhbHVlCiAgICAgICAgJm11dCBsb2NhbCwKICAgICk7Ci8vIHNldCBmdW5jdGlvbiBhcyBwcm9wZXJ0eQogICAgbmFwaV9zZXRfbmFtZWRfcHJvcGVydHkoZW52LCBleHBvcnRzLCBwLmFzX3B0cigpLCBsb2NhbCk7Ci8vIHJldHVybmluZyBleHBvcnRzCiAgICBleHBvcnRzCn0KYCkpLG1keCgicCIsbnVsbCxtZHgoImltZyIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InAifSx7InNyYyI6Imh0dHBzOi8vZGV2LXRvLXVwbG9hZHMuczMuYW1hem9uYXdzLmNvbS9pL2Nmem1uMjByMGRvaXVoZGdxYXEzLnBuZyIsImFsdCI6IkV4YW1wbGUifSkpKSxtZHgoInAiLG51bGwsYEluIHRoZSBhYm92ZSBleGFtcGxlLCB3ZSBjcmVhdGVkIGEgZnVuY3Rpb24gaW4gUnVzdCBuYW1lZCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgc2F5X2hlbGxvYCksYCwgd2hpY2ggaXMgZXhlY3V0ZWQgd2hlbiB0aGUgSmF2YVNjcmlwdCBjYWxscyB0aGUgZnVuY3Rpb24uIFdlIGNyZWF0ZWQgYSBmdW5jdGlvbiB1c2luZyBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV9jcmVhdGVfZnVuY3Rpb25gKSxgLCB3aGljaCB0YWtlcyB0aGUgZm9sbG93aW5nIGFyZ3VtZW50czpgKSxtZHgoInVsIixudWxsLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LGBUaGUgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJsaSJ9LGBuYXBpX2VudmApLGAgdmFsdWUgb2YgdGhlIGVudmlyb25tZW50YCksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYEEgc3RyaW5nIGZvciB0aGUgZnVuY3Rpb24gbmFtZSB3aGljaCB0aGF0IGJlIGdpdmVuIHRvIHRoZSBKYXZhU2NyaXB0IGZ1bmN0aW9uYCksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYFRoZSBsZW5ndGggb2YgdGhlIGZ1bmN0aW9uIG5hbWUgc3RyaW5nYCksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYFRoZSBmdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIHdoZW4gdGhlIEphdmFTY3JpcHQgY2FsbHMgdGhlIG5ld2x5IGNyZWF0ZWQgZnVuY3Rpb25gKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgQ29udGV4dCBkYXRhIHRoYXQgY2FuIGJlIHBhc3NlZCBieSB0aGUgdXNlciBsYXRlciBhbmQgYWNjZXNzZWQgZnJvbSB0aGUgUnVzdCBmdW5jdGlvbmApLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LGBBbiBlbXB0eSBtZW1vcnkgYWRkcmVzcyB3aGVyZSB0aGUgcG9pbnRlciB0byB0aGUgSmF2YVNjcmlwdCBmdW5jdGlvbiBjYW4gYmUgc2F2ZWRgKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgV2hlbiB5b3UgY3JlYXRlIHRoaXMgZnVuY3Rpb24sIGFkZCBpdCBhcyBhIHByb3BlcnR5IHRvIHlvdXIgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJsaSJ9LGBleHBvcnRzYCksYCBvYmplY3Qgc28gdGhhdCB5b3UgY2FuIHVzZSBpdCBmcm9tIEphdmFTY3JpcHRgKSksbWR4KCJwIixudWxsLGBUaGUgZnVuY3Rpb24gb24gdGhlIFJ1c3Qgc2lkZSBtdXN0IGhhdmUgdGhlIHNhbWUgc2lnbmF0dXJlIGFzIHNob3duIGluIHRoZSBleGFtcGxlLiBXZeKAmWxsIGRpc2N1c3MgbmV4dCBob3cgdG8gYWNjZXNzIGFyZ3VtZW50cyBpbnNpZGUgYSBmdW5jdGlvbiB1c2luZyBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV9jYWxsYmFja19pbmZvYCksYC4gV2UgY2FuIGFjY2VzcyB0aGlzIGZyb20gYSBmdW5jdGlvbiBhbmQgb3RoZXIgYXJndW1lbnRzIGFzIHdlbGwuYCksbWR4KCJwIixudWxsLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LGBBY2Nlc3NpbmdgKSxgIGAsbWR4KCJzdHJvbmciLHtwYXJlbnROYW1lOiJwIn0sYGFyZ3VtZW50c2ApKSxtZHgoInAiLG51bGwsYEZ1bmN0aW9uIGFyZ3VtZW50cyBhcmUgdmVyeSBpbXBvcnRhbnQuIE4tQVBJIHByb3ZpZGVzIGEgbWV0aG9kIHRvIGFjY2VzcyB0aGVzZSBhcmd1bWVudHMuIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2NhbGxiYWNrX2luZm9gKSxgIHByb3ZpZGVzIHRoZSBwb2ludGVyIHdpdGggZGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGZ1bmN0aW9uIGluIHRoZSBKYXZhU2NyaXB0IHNpZGUgb2YgdGhlIGNvZGUuYCksbWR4KCJwcmUiLG51bGwsbWR4KCJjb2RlIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicHJlIn0se30pLGB1c2Ugbm9kZWpzX3N5czo6ewogICAgbmFwaV9jYWxsYmFja19pbmZvLCBuYXBpX2NyZWF0ZV9kb3VibGUsIG5hcGlfY3JlYXRlX2Z1bmN0aW9uLCBuYXBpX2VudiwgbmFwaV9nZXRfY2JfaW5mbywKICAgIG5hcGlfZ2V0X3ZhbHVlX2RvdWJsZSwgbmFwaV9zZXRfbmFtZWRfcHJvcGVydHksIG5hcGlfdmFsdWUsCn07CnVzZSBzdGQ6OmZmaTo6Q1N0cmluZzsKCnB1YiB1bnNhZmUgZXh0ZXJuICJDIiBmbiBhZGQoZW52OiBuYXBpX2VudiwgaW5mbzogbmFwaV9jYWxsYmFja19pbmZvKSAtPiBuYXBpX3ZhbHVlIHsKLy8gY3JlYXRpbmcgYSBidWZmZXIgd2hlcmUgbmFwaV92YWx1ZSBvZiBhcmd1bWVudCBiZSB3cml0dGVuCiAgICBsZXQgbXV0IGJ1ZmZlcjogW25hcGlfdmFsdWU7IDJdID0gc3RkOjptZW06Ok1heWJlVW5pbml0Ojp6ZXJvZWQoKS5hc3N1bWVfaW5pdCgpOwovLyBtYXggbnVtYmVyIG9mIGFyZ3VtZW50cwogICAgbGV0IG11dCBhcmdjID0gMiBhcyB1c2l6ZTsKLy8gZ2V0dGluZyBhcmd1bWVudHMgYW5kIHZhbHVlIG9mIHRoaXMKICAgIG5hcGlfZ2V0X2NiX2luZm8oCiAgICAgICAgZW52LAogICAgICAgIGluZm8sCiAgICAgICAgJm11dCBhcmdjLAogICAgICAgIGJ1ZmZlci5hc19tdXRfcHRyKCksCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICApOwovLyBjb252ZXJ0aW5nIG5hcGkgdG8gZjY0CiAgICBsZXQgbXV0IHggPSAwIGFzIGY2NDsKICAgIGxldCBtdXQgeSA9IDAgYXMgZjY0OwogICAgbmFwaV9nZXRfdmFsdWVfZG91YmxlKGVudiwgYnVmZmVyWzBdLCAmbXV0IHgpOwogICAgbmFwaV9nZXRfdmFsdWVfZG91YmxlKGVudiwgYnVmZmVyWzFdLCAmbXV0IHkpOwovLyBjcmVhdGluZyB0aGUgcmV0dXJuIHZhbHVlCiAgICBsZXQgbXV0IGxvY2FsOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwogICAgbmFwaV9jcmVhdGVfZG91YmxlKGVudiwgeCArIHksICZtdXQgbG9jYWwpOwovLyByZXR1cm5pbmcgdGhlIHJlc3VsdAogICAgbG9jYWwKfQoKI1tub19tYW5nbGVdCnB1YiB1bnNhZmUgZXh0ZXJuICJDIiBmbiBuYXBpX3JlZ2lzdGVyX21vZHVsZV92MSgKICAgIGVudjogbmFwaV9lbnYsCiAgICBleHBvcnRzOiBuYXBpX3ZhbHVlLAopIC0+IG5vZGVqc19zeXM6Om5hcGlfdmFsdWUgewovLyBjcmVhdGluZyBhIGZ1bmN0aW9uIG5hbWUKICAgIGxldCBwID0gQ1N0cmluZzo6bmV3KCJteUZ1bmMiKS5leHBlY3QoIkNTdHJpbmc6Om5ldyBmYWlsZWQiKTsKICAgIGxldCBtdXQgbG9jYWw6IG5hcGlfdmFsdWUgPSBzdGQ6Om1lbTo6emVyb2VkKCk7Ci8vIGNyZWF0aW5nIHRoZSBmdW5jdGlvbgogICAgbmFwaV9jcmVhdGVfZnVuY3Rpb24oCiAgICAgICAgZW52LAogICAgICAgIHAuYXNfcHRyKCksCiAgICAgICAgNSwKICAgICAgICBTb21lKGFkZCksCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgJm11dCBsb2NhbCwKICAgICk7Ci8vIHNldHRpbmcgZnVuY3Rpb24gYXMgcHJvcGVydHkKICAgIG5hcGlfc2V0X25hbWVkX3Byb3BlcnR5KGVudiwgZXhwb3J0cywgcC5hc19wdHIoKSwgbG9jYWwpOwovLyByZXR1cm5pbmcgZXhwb3J0cwogICAgZXhwb3J0cwp9CmApKSxtZHgoInAiLG51bGwsbWR4KCJpbWciLF9leHRlbmRzKHtwYXJlbnROYW1lOiJwIn0seyJzcmMiOiJodHRwczovL2Rldi10by11cGxvYWRzLnMzLmFtYXpvbmF3cy5jb20vaS91M3IyajF4dzFvaDQzanI4Z3lndi5wbmciLCJhbHQiOiJFeGFtcGxlIn0pKSksbWR4KCJwIixudWxsLGBVc2UgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfZ2V0X2NiX2luZm9gKSxgIHRvIGdldCB0aGUgYXJndW1lbnRzLiBUaGUgZm9sbG93aW5nIGFyZ3VtZW50cyBtdXN0IGJlIHByb3ZpZGVkOmApLG1keCgidWwiLG51bGwsbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToibGkifSxgbmFwaV9lbnZgKSksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYFRoZSBpbmZvIHBvaW50ZXJgKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgVGhlIG51bWJlciBvZiBleHBlY3RlZCBhcmd1bWVudHNgKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgQSBidWZmZXIgd2hlcmUgYXJndW1lbnRzIGNhbiBiZSB3cml0dGVuIGFzIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToibGkifSxgbmFwaV92YWx1ZWApKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgQSBtZW1vcnkgbG9jYXRpb24gdG8gc3RvcmUgbWV0YWRhdGEgdGhlIHVzZXIgcHJvdmlkZWQgd2hlbiBKYXZhU2NyaXB0IGZ1bmN0aW9uIHdhcyBjcmVhdGVkYCksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYEEgbWVtb3J5IGxvY2F0aW9uIHdoZXJlIHRoaXMgdmFsdWUgcG9pbnRlciBjYW4gYmUgd3JpdHRlbmApKSxtZHgoInAiLG51bGwsYFdlIG5lZWQgdG8gY3JlYXRlIGFuIGFycmF5IHdpdGggbWVtb3J5IGxvY2F0aW9ucyB3aGVyZSBDIGNhbiB3cml0ZSBhIHBvaW50ZXIgdG8gYXJndW1lbnRzIGFuZCB3ZSBjYW4gcGFzcyB0aGlzIHBvaW50ZXIgYnVmZmVyIHRvIE4tQVBJIGZ1bmN0aW9uLiBXZSBhbHNvIGdldCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgdGhpc2ApLGAsIGJ1dCB3ZSBhcmVu4oCZdCB1c2luZyBpdCBpbiB0aGlzIGV4YW1wbGUuYCksbWR4KCJwIixudWxsLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LGBXb3JraW5nIHdpdGggc3RyaW5ncyBhcmd1bWVudHNgKSksbWR4KCJwIixudWxsLGBNb3N0IG9mIHRoZSB0aW1lLCB5b3UgbmVlZCB0byB3b3JrIHdpdGggc3RyaW5ncyBpbiBKYXZhU2NyaXB0LiBCb3RoIGNyZWF0aW5nIGFuZCBnZXR0aW5nIHRoZSB2YWx1ZSBvZiBhIHN0cmluZyBhcmUgcHJldHR5IHN0cmFpZ2h0Zm9yd2FyZC4gVXNlIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2dldF92YWx1ZV9zdHJpbmdfdXRmOGApLGAgYW5kIGNhbGwgdGhpcyBmdW5jdGlvbiB0d2ljZTogdGhlIGZpcnN0IHRpbWUgdG8gZ2V0IGxlbmd0aCBhbmQgc2Vjb25kIHRpbWUgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgc3RyaW5nLmApLG1keCgicHJlIixudWxsLG1keCgiY29kZSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InByZSJ9LHt9KSxgdXNlIG5vZGVqc19zeXM6OnsKICAgIG5hcGlfY2FsbGJhY2tfaW5mbywgbmFwaV9jcmVhdGVfZnVuY3Rpb24sIG5hcGlfZW52LCBuYXBpX2dldF9jYl9pbmZvLCBuYXBpX2dldF91bmRlZmluZWQsCiAgICBuYXBpX2dldF92YWx1ZV9zdHJpbmdfdXRmOCwgbmFwaV9zZXRfbmFtZWRfcHJvcGVydHksIG5hcGlfdmFsdWUsCn07Cgp1c2Ugc3RkOjpmZmk6OkNTdHJpbmc7CgpwdWIgdW5zYWZlIGV4dGVybiAiQyIgZm4gcHJpbnQoZW52OiBuYXBpX2VudiwgaW5mbzogbmFwaV9jYWxsYmFja19pbmZvKSAtPiBuYXBpX3ZhbHVlIHsKLy8gY3JlYXRpbmcgYSBidWZmZXIgb2YgYXJndW1lbnRzCiAgICBsZXQgbXV0IGJ1ZmZlcjogW25hcGlfdmFsdWU7IDFdID0gc3RkOjptZW06Ok1heWJlVW5pbml0Ojp6ZXJvZWQoKS5hc3N1bWVfaW5pdCgpOwogICAgbGV0IG11dCBhcmdjID0gMSBhcyB1c2l6ZTsKLy8gZ2V0dGluZyBhcmd1bWVudHMKICAgIG5hcGlfZ2V0X2NiX2luZm8oCiAgICAgICAgZW52LAogICAgICAgIGluZm8sCiAgICAgICAgJm11dCBhcmdjLAogICAgICAgIGJ1ZmZlci5hc19tdXRfcHRyKCksCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICApOwogICAgbGV0IG11dCBsZW4gPSAwOwovLyBnZXR0aW5nIGxlbmd0aCBieSBwYXNzaW5nIG51bGwgYnVmZmVyCiAgICBuYXBpX2dldF92YWx1ZV9zdHJpbmdfdXRmOChlbnYsIGJ1ZmZlclswXSwgc3RkOjpwdHI6Om51bGxfbXV0KCksIDAsICZtdXQgbGVuKTsKICAgIGxldCBzaXplID0gbGVuIGFzIHVzaXplOwovLyBjcmVhdGluZyBhIGJ1ZmZlciB3aGVyZSBzdHJpbmcgY2FuIGJlIHBsYWNlZAogICAgbGV0IG11dCB2ZTogVmVjPHU4PiA9IFZlYzo6d2l0aF9jYXBhY2l0eShzaXplICsgMSk7CiAgICBsZXQgcmF3ID0gdmUuYXNfbXV0X3B0cigpOwovLyB0ZWxsaW5nIHJ1c3Qgbm90IG1hbmFnZSB0aGUgdmVjdG9yCiAgICBzdGQ6Om1lbTo6Zm9yZ2V0KHZlKTsKICAgIGxldCBtdXQgY2FwID0gMDsKLy8gZ2V0dGluZyB0aGUgc3RyaW5nIHZhbHVlIGZyb20gbmFwaV92YWx1ZQogICAgbGV0IF9zID0gbmFwaV9nZXRfdmFsdWVfc3RyaW5nX3V0ZjgoZW52LCBidWZmZXJbMF0sIHJhdyBhcyAqbXV0IGk4LCBzaXplICsgMSwgJm11dCBjYXApOwogICAgbGV0IHMgPSBTdHJpbmc6OmZyb21fcmF3X3BhcnRzKHJhdywgY2FwIGFzIHVzaXplLCBzaXplKTsKLy8gcHJpbnRpbmcgdGhlIHN0cmluZwogICAgcHJpbnRsbiEoInt9Iiwgcyk7Ci8vIGNyZWF0aW5nIGFuIHVuZGVmaW5lZAogICAgbGV0IG11dCB1bmQ6IG5hcGlfdmFsdWUgPSBzdGQ6Om1lbTo6emVyb2VkKCk7CiAgICBuYXBpX2dldF91bmRlZmluZWQoZW52LCAmbXV0IHVuZCk7Ci8vIHJldHVybmluZyB1bmRlZmluZWQKICAgIHVuZAp9CgojW25vX21hbmdsZV0KcHViIHVuc2FmZSBleHRlcm4gIkMiIGZuIG5hcGlfcmVnaXN0ZXJfbW9kdWxlX3YxKAogICAgZW52OiBuYXBpX2VudiwKICAgIGV4cG9ydHM6IG5hcGlfdmFsdWUsCikgLT4gbm9kZWpzX3N5czo6bmFwaV92YWx1ZSB7CiAgICBsZXQgcCA9IENTdHJpbmc6Om5ldygibXlGdW5jIikuZXhwZWN0KCJDU3RyaW5nOjpuZXcgZmFpbGVkIik7CiAgICBsZXQgbXV0IGxvY2FsOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwogICAgbmFwaV9jcmVhdGVfZnVuY3Rpb24oCiAgICAgICAgZW52LAogICAgICAgIHAuYXNfcHRyKCksCiAgICAgICAgNSwKICAgICAgICBTb21lKHByaW50KSwKICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAmbXV0IGxvY2FsLAogICAgKTsKICAgIG5hcGlfc2V0X25hbWVkX3Byb3BlcnR5KGVudiwgZXhwb3J0cywgcC5hc19wdHIoKSwgbG9jYWwpOwogICAgZXhwb3J0cwp9CmApKSxtZHgoInAiLG51bGwsbWR4KCJpbWciLF9leHRlbmRzKHtwYXJlbnROYW1lOiJwIn0seyJzcmMiOiJodHRwczovL2Rldi10by11cGxvYWRzLnMzLmFtYXpvbmF3cy5jb20vaS96YmsxNWNzeGFrOTVxdm5kMnRjZy5wbmciLCJhbHQiOiJFeGFtcGxlIn0pKSksbWR4KCJwIixudWxsLGBZb3XigJlsbCBuZWVkIHRvIHBhc3MgYSBmZXcgYXJndW1lbnRzIHRvIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2NyZWF0ZV9zdHJpbmdfdXRmOGApLGAgdG8gY3JlYXRlIGEgc3RyaW5nLiBJZiBhIG51bGwgcG9pbnRlciBpcyBwYXNzZWQgYXMgYnVmZmVyLCB0aGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcgaXMgZ2l2ZW4uIFRoZSBmb2xsb3dpbmcgYXJndW1lbnRzIGFyZSByZXF1aXJlZDpgKSxtZHgoInVsIixudWxsLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6ImxpIn0sYG5hcGlfZW52YCkpLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6ImxpIn0sYG5hcGlfdmFsdWVgKSxgIHBvaW50ZXIgdG8gdGhlIHN0cmluZyBpbiBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6ImxpIn0sYGphdmFzY3JpcHQgc2lkZWApKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgVGhlIGJ1ZmZlciB3aGVyZSB0aGUgc3RyaW5nIGlzIHRvIGJlIHdyaXR0ZW4gaWYgbnVsbCBnaXZlcyB0aGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmdgKSxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxgVGhlIGxlbmd0aCBvZiB0aGUgYnVmZmVyYCksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sYEJ5dGVzIHdyaXR0ZW4gdG8gdGhlIGJ1ZmZlcmApKSxtZHgoImgyIix7ImlkIjoid29ya2luZy13aXRoLXByb21pc2VzLWFuZC1saWJ1di10aHJlYWQtcG9vbCJ9LGBXb3JraW5nIHdpdGggcHJvbWlzZXMgYW5kIGxpYnV2IHRocmVhZCBwb29sYCksbWR4KCJwIixudWxsLGBJdOKAmXMgbm90IGEgZ29vZCBpZGVhIHRvIGJsb2NrIHRoZSBtYWluIHRocmVhZCBvZiBOb2RlLmpzIGZvciBkb2luZyBjYWxjdWxhdGlvbnMuIFlvdSBjYW4gdXNlIGxpYnV2IHRocmVhZHMgdG8gZG8gdGhlIGhlYXZ5IGxpZnRpbmcuYCksbWR4KCJwIixudWxsLGBGaXJzdCwgY3JlYXRlIGEgcHJvbWlzZS4gVGhlIHByb21pc2Ugd2lsbCByZWplY3Qgb3IgcmVzb2x2ZSBiYXNlZCBvbiB0aGUgc3VjY2VzcyBvZiB5b3VyIHdvcmsuIEZvciB0aGlzLCB5b3XigJlsbCBuZWVkIHRvIGNyZWF0ZSB0aHJlZSBmdW5jdGlvbnMuIFRoZSBmaXJzdCBvbmUgaXMgY2FsbGVkIGZyb20gdGhlIEphdmFTY3JpcHQgd29ybGQgYW5kIHRoZSBjb250cm9sIHdvdWxkIGJlIHBhc3NlZCB0byB0aGUgc2Vjb25kIGZ1bmN0aW9uLCB3aGljaCBydW5zIG9uIGxpYnV2IHRocmVhZCBhbmQgaGFzIG5vIGFjY2VzcyB0byBKYXZhU2NyaXB0LiBUaGUgdGhpcmQgZnVuY3Rpb24sIHdoaWNoIGRvZXMgaGF2ZSBhY2Nlc3MgdG8gdGhlIEphdmFTY3JpcHQgc2lkZSwgaXMgY2FsbGVkIGFmdGVyIHRoZSBzZWNvbmQgZmluaXNoZXMuIFlvdSBjYW4gdXNlIHRoZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV9jcmVhdGVfYXN5bmNfd29ya2ApLGAgbWV0aG9kIGZvciB0aGUgbGlidXYgdGhyZWFkLmApLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxgQ3JlYXRpbmcgYSBwcm9taXNlYCkpLG1keCgicCIsbnVsbCxgVG8gY3JlYXRlIGEgcHJvbWlzZSwgc2ltcGx5IHVzZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV9jcmVhdGVfcHJvbWlzZWApLGAuIFRoaXMgd2lsbCBwcm92aWRlIGEgcG9pbnRlciwgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfZGVmZXJyZWRgKSxgLCB3aGljaCBjYW4gdGhlbiByZXNvbHZlIG9yIHJlamVjdCBhIHByb21pc2UgdXNpbmcgdGhlIGZvbGxvd2luZyBmdW5jdGlvbnM6YCksbWR4KCJ1bCIsbnVsbCxtZHgoImxpIix7cGFyZW50TmFtZToidWwifSxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJsaSJ9LGBuYXBpX3Jlc29sdmVfZGVmZXJyZWRgKSksbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToibGkifSxgbmFwaV9yZWplY3RfZGVmZXJyZWRgKSkpLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxgRXJyb3IgaGFuZGxpbmdgKSksbWR4KCJwIixudWxsLGBZb3UgY2FuIGNyZWF0ZSBhbmQgdGhyb3cgYW4gZXJyb3IgZnJvbSB0aGUgUnVzdCBjb2RlIHVzaW5nIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2NyZWF0ZV9lcnJvcmApLGAgYW5kIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX3Rocm93X2Vycm9yYCksYC4gRXZlcnkgTi1BUEkgZnVuY3Rpb24gcmV0dXJucyBhIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX3N0YXR1c2ApLGAsIHdoaWNoIHNob3VsZCBiZSBjaGVja2VkLmApLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxgUmVhbCBjb2RlYCkpLG1keCgicCIsbnVsbCxgVGhlIGZvbGxvd2luZyBleGFtcGxlIHNob3dzIGhvdyB0byBzY2hlZHVsZSBhc3luYyB3b3JrLmApLG1keCgicHJlIixudWxsLG1keCgiY29kZSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InByZSJ9LHsiY2xhc3NOYW1lIjoibGFuZ3VhZ2UtcnVzdCJ9KSxgICAgIHVzZSBub2RlanNfc3lzOjp7CiAgICAgICAgbmFwaV9hc3luY193b3JrLCBuYXBpX2NhbGxiYWNrX2luZm8sIG5hcGlfY3JlYXRlX2FzeW5jX3dvcmssIG5hcGlfY3JlYXRlX2Vycm9yLAogICAgICAgIG5hcGlfY3JlYXRlX2Z1bmN0aW9uLCBuYXBpX2NyZWF0ZV9pbnQ2NCwgbmFwaV9jcmVhdGVfcHJvbWlzZSwgbmFwaV9jcmVhdGVfc3RyaW5nX3V0ZjgsCiAgICAgICAgbmFwaV9kZWZlcnJlZCwgbmFwaV9kZWxldGVfYXN5bmNfd29yaywgbmFwaV9lbnYsIG5hcGlfZ2V0X2NiX2luZm8sIG5hcGlfZ2V0X3ZhbHVlX2ludDY0LAogICAgICAgIG5hcGlfcXVldWVfYXN5bmNfd29yaywgbmFwaV9yZWplY3RfZGVmZXJyZWQsIG5hcGlfcmVzb2x2ZV9kZWZlcnJlZCwgbmFwaV9zZXRfbmFtZWRfcHJvcGVydHksCiAgICAgICAgbmFwaV9zdGF0dXMsIG5hcGlfdmFsdWUsCiAgICB9OwogICAgdXNlIHN0ZDo6ZmZpOjpjX3ZvaWQ7CiAgICB1c2Ugc3RkOjpmZmk6OkNTdHJpbmc7CgogICAgI1tkZXJpdmUoRGVidWcsIENsb25lKV0KICAgIHN0cnVjdCBEYXRhIHsKICAgICAgICBkZWZlcnJlZDogbmFwaV9kZWZlcnJlZCwKICAgICAgICB3b3JrOiBuYXBpX2FzeW5jX3dvcmssCiAgICAgICAgdmFsOiB1NjQsCiAgICAgICAgcmVzdWx0OiBPcHRpb248UmVzdWx0PHU2NCwgU3RyaW5nPj4sCiAgICB9CgogICAgcHViIHVuc2FmZSBleHRlcm4gIkMiIGZuIGZlYihlbnY6IG5hcGlfZW52LCBpbmZvOiBuYXBpX2NhbGxiYWNrX2luZm8pIC0+IG5hcGlfdmFsdWUgewogICAgICAgIGxldCBtdXQgYnVmZmVyOiBWZWM8bmFwaV92YWx1ZT4gPSBWZWM6OndpdGhfY2FwYWNpdHkoMSk7CiAgICAgICAgbGV0IHAgPSBidWZmZXIuYXNfbXV0X3B0cigpOwogICAgICAgIGxldCBtdXQgYXJnYyA9IDEgYXMgdXNpemU7CiAgICAgICAgc3RkOjptZW06OmZvcmdldChidWZmZXIpOwogICAgICAgIG5hcGlfZ2V0X2NiX2luZm8oCiAgICAgICAgICAgIGVudiwKICAgICAgICAgICAgaW5mbywKICAgICAgICAgICAgJm11dCBhcmdjLAogICAgICAgICAgICBwLAogICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgKTsKICAgICAgICBsZXQgbXV0IHN0YXJ0ID0gMDsKICAgICAgICBuYXBpX2dldF92YWx1ZV9pbnQ2NChlbnYsICpwLCAmbXV0IHN0YXJ0KTsKICAgICAgICBsZXQgbXV0IHByb21pc2U6IG5hcGlfdmFsdWUgPSBzdGQ6Om1lbTo6emVyb2VkKCk7CiAgICAgICAgbGV0IG11dCBkZWZlcnJlZDogbmFwaV9kZWZlcnJlZCA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICBsZXQgbXV0IHdvcmtfbmFtZTogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICBsZXQgbXV0IHdvcms6IG5hcGlfYXN5bmNfd29yayA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICBsZXQgYXN5bmNfbmFtZSA9IENTdHJpbmc6Om5ldygiYXN5bmMgZmlib25hY2kiKS5leHBlY3QoIkVycm9yIGNyZWF0aW5nIHN0cmluZyIpOwogICAgICAgIG5hcGlfY3JlYXRlX3N0cmluZ191dGY4KGVudiwgYXN5bmNfbmFtZS5hc19wdHIoKSwgMTMsICZtdXQgd29ya19uYW1lKTsKICAgICAgICBuYXBpX2NyZWF0ZV9wcm9taXNlKGVudiwgJm11dCBkZWZlcnJlZCwgJm11dCBwcm9taXNlKTsKICAgICAgICBsZXQgdiA9IERhdGEgewogICAgICAgICAgICBkZWZlcnJlZCwKICAgICAgICAgICAgd29yaywKICAgICAgICAgICAgdmFsOiBzdGFydCBhcyB1NjQsCiAgICAgICAgICAgIHJlc3VsdDogTm9uZSwKICAgICAgICB9OwogICAgICAgIGxldCBkYXRhID0gQm94OjpuZXcodik7CiAgICAgICAgbGV0IHJhdyA9IEJveDo6aW50b19yYXcoZGF0YSk7CiAgICAgICAgbmFwaV9jcmVhdGVfYXN5bmNfd29yaygKICAgICAgICAgICAgZW52LAogICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgd29ya19uYW1lLAogICAgICAgICAgICBTb21lKHBlcmZvcm0pLAogICAgICAgICAgICBTb21lKGNvbXBsZXRlKSwKICAgICAgICAgICAgc3RkOjptZW06OnRyYW5zbXV0ZShyYXcpLAogICAgICAgICAgICAmbXV0IHdvcmssCiAgICAgICAgKTsKICAgICAgICBuYXBpX3F1ZXVlX2FzeW5jX3dvcmsoZW52LCB3b3JrKTsKICAgICAgICAoKnJhdykud29yayA9IHdvcms7CiAgICAgICAgcHJvbWlzZQogICAgfQoKICAgIHB1YiB1bnNhZmUgZXh0ZXJuICJDIiBmbiBwZXJmb3JtKF9lbnY6IG5hcGlfZW52LCBkYXRhOiAqbXV0IGNfdm9pZCkgewogICAgICAgIGxldCBtdXQgdDogQm94PERhdGE+ID0gQm94Ojpmcm9tX3JhdyhzdGQ6Om1lbTo6dHJhbnNtdXRlKGRhdGEpKTsKICAgICAgICBsZXQgbXV0IGxhc3QgPSAxOwogICAgICAgIGxldCBtdXQgc2Vjb25kX2xhc3QgPSAwOwogICAgICAgIGZvciBfIGluIDIuLnQudmFsIHsKICAgICAgICAgICAgbGV0IHRlbXAgPSBsYXN0OwogICAgICAgICAgICBsYXN0ID0gbGFzdCArIHNlY29uZF9sYXN0OwogICAgICAgICAgICBzZWNvbmRfbGFzdCA9IHRlbXA7CiAgICAgICAgfQogICAgICAgIHQucmVzdWx0ID0gU29tZShPayhsYXN0KSk7CiAgICAgICAgQm94OjppbnRvX3Jhdyh0YXNrKTsKICAgIH0KCiAgICBwdWIgdW5zYWZlIGV4dGVybiAiQyIgZm4gY29tcGxldGUoZW52OiBuYXBpX2VudiwgX3N0YXR1czogbmFwaV9zdGF0dXMsIGRhdGE6ICptdXQgY192b2lkKSB7CiAgICAgICAgbGV0IHQ6IEJveDxEYXRhPiA9IEJveDo6ZnJvbV9yYXcoc3RkOjptZW06OnRyYW5zbXV0ZShkYXRhKSk7CiAgICAgICAgbGV0IHYgPSBtYXRjaCB0LnJlc3VsdCB7CiAgICAgICAgICAgIFNvbWUoZCkgPT4gbWF0Y2ggZCB7CiAgICAgICAgICAgICAgICBPayhyZXN1bHQpID0+IHJlc3VsdCwKICAgICAgICAgICAgICAgIEVycihfKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG11dCBqc19lcnJvcjogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICAgICAgICAgICAgICBuYXBpX2NyZWF0ZV9lcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgZW52LAogICAgICAgICAgICAgICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICZtdXQganNfZXJyb3IsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBuYXBpX3JlamVjdF9kZWZlcnJlZChlbnYsIHQuZGVmZXJyZWQsIGpzX2Vycm9yKTsKICAgICAgICAgICAgICAgICAgICBuYXBpX2RlbGV0ZV9hc3luY193b3JrKGVudiwgdC53b3JrKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE5vbmUgPT4gewogICAgICAgICAgICAgICAgbGV0IG11dCBqc19lcnJvcjogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICAgICAgICAgIG5hcGlfY3JlYXRlX2Vycm9yKAogICAgICAgICAgICAgICAgICAgIGVudiwKICAgICAgICAgICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgICAgICAgICAmbXV0IGpzX2Vycm9yLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG5hcGlfcmVqZWN0X2RlZmVycmVkKGVudiwgdC5kZWZlcnJlZCwganNfZXJyb3IpOwogICAgICAgICAgICAgICAgbmFwaV9kZWxldGVfYXN5bmNfd29yayhlbnYsIHQud29yayk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGxldCBtdXQgb2JqOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwogICAgICAgIG5hcGlfY3JlYXRlX2ludDY0KGVudiwgdiBhcyBpNjQsICZtdXQgb2JqKTsKICAgICAgICBuYXBpX3Jlc29sdmVfZGVmZXJyZWQoZW52LCB0LmRlZmVycmVkLCBvYmopOwoKICAgICAgICBuYXBpX2RlbGV0ZV9hc3luY193b3JrKGVudiwgdC53b3JrKTsKICAgIH0KCiAgICAjW25vX21hbmdsZV0KICAgIHB1YiB1bnNhZmUgZXh0ZXJuICJDIiBmbiBuYXBpX3JlZ2lzdGVyX21vZHVsZV92MSgKICAgICAgICBlbnY6IG5hcGlfZW52LAogICAgICAgIGV4cG9ydHM6IG5hcGlfdmFsdWUsCiAgICApIC0+IG5vZGVqc19zeXM6Om5hcGlfdmFsdWUgewogICAgICAgIGxldCBwID0gQ1N0cmluZzo6bmV3KCJteUZ1bmMiKS5leHBlY3QoIkNTdHJpbmc6Om5ldyBmYWlsZWQiKTsKICAgICAgICBsZXQgbXV0IGxvY2FsOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwogICAgICAgIG5hcGlfY3JlYXRlX2Z1bmN0aW9uKAogICAgICAgICAgICBlbnYsCiAgICAgICAgICAgIHAuYXNfcHRyKCksCiAgICAgICAgICAgIDUsCiAgICAgICAgICAgIFNvbWUoZmViKSwKICAgICAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgICAgICZtdXQgbG9jYWwsCiAgICAgICAgKTsKICAgICAgICBuYXBpX3NldF9uYW1lZF9wcm9wZXJ0eShlbnYsIGV4cG9ydHMsIHAuYXNfcHRyKCksIGxvY2FsKTsKICAgICAgICBleHBvcnRzCiAgICB9CmApKSxtZHgoInAiLG51bGwsYFdlIGNyZWF0ZWQgYSBzdHJ1Y3QgdG8gc3RvcmUgYSBwb2ludGVyIHRvIG91ciBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbmFwaV9hc3luY193b3JrYCksYCBhbmQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfZGVmZXJyZWRgKSxgIGFzIHdlbGwgYXMgb3VyIG91dHB1dC4gSW5pdGlhbGx5LCB0aGUgb3V0cHV0IGlzIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBOb25lYCksYC4gVGhlbiB3ZSBjcmVhdGVkIGEgcHJvbWlzZSwgd2hpY2ggcHJvdmlkZXMgYSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgZGVmZXJyZWRgKSxgIHRoYXQgd2Ugc2F2ZSBpbiBvdXIgZGF0YS4gVGhpcyBkYXRhIGlzIGF2YWlsYWJsZSB0byB1cyBpbiBhbGwgb2Ygb3VyIGZ1bmN0aW9ucy4gTmV4dCwgd2UgY29udmVydGVkIG91ciBkYXRhIGludG8gcmF3IGRhdGEgYW5kIHBhc3MgaXQgdG8gdGhlIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBuYXBpX2NyZWF0ZV9hc3luY193b3JrYCksYCBmdW5jdGlvbiB3aXRoIG90aGVyIGNhbGxiYWNrcy4gV2UgcmV0dXJuZWQgdGhlIHByb21pc2Ugd2UgY3JlYXRlZCwgZXhlY3V0ZWQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYHBlcmZvcm1gKSxgLCBhbmQgY29udmVydGVkIG91ciBkYXRhIGJhY2sgdG8gc3RydWN0LiBPbmNlIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBwZXJmb3JtYCksYCBpcyBjb21wbGV0ZWQgb24gbGlidXYgdGhyZWFkLCBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgY29tcGxldGVgKSxgIGlzIGNhbGxlZCBmcm9tIHRoZSBtYWluIHRocmVhZCwgYWxvbmcgd2l0aCB0aGUgc3RhdHVzIG9mIHRoZSBwcmV2aW91cyBvcGVyYXRpb24gYW5kIG91ciBkYXRhLiBOb3cgd2UgY2FuIHJlamVjdCBvciByZXNvbHZlIG91ciB3b3JrIGFuZCBkZWxldGUgd29yayBmcm9tIHRoZSBxdWV1ZS5gKSxtZHgoInAiLG51bGwsbWR4KCJzdHJvbmciLHtwYXJlbnROYW1lOiJwIn0sYExldHMgd2FsayB0aHJvdWdoIHRoZSBjb2RlYCkpLG1keCgicCIsbnVsbCxgQ3JlYXRlIGEgZnVuY3Rpb24gY2FsbGVkIGAsbWR4KCJpbmxpbmVDb2RlIix7cGFyZW50TmFtZToicCJ9LGBmZWJgKSxgLCB3aGljaCB3aWxsIGJlIGV4cG9ydGVkIHRvIEphdmFTY3JpcHQuIFRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gYSBwcm9taXNlIGFuZCBzY2hlZHVsZSB3b3JrIGZvciB0aGUgbGlidXYgdGhyZWFkIHBvb2wuIFlvdSBjYW4gYWNoaWV2ZSB0aGlzIGJ5IGNyZWF0aW5nIGEgcHJvbWlzZSwgdXNpbmcgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYG5hcGlfY3JlYXRlX2FzeW5jX3dvcmtgKSxgLCBhbmQgcGFzc2luZyB0d28gZnVuY3Rpb25zIHRvIGl0LiBPbmUgaXMgZXhlY3V0ZWQgb24gdGhlIGxpYnV2IHRocmVhZCBhbmQgdGhlIG90aGVyIG9uIHRoZSBtYWluIHRocmVhZC4gU2luY2UgeW91IGNhbiBvbmx5IGV4ZWN1dGUgSmF2YVNjcmlwdCBmcm9tIHRoZSBtYWluIHRocmVhZCwgeW91IG11c3QgcmVzb2x2ZSBvciByZWplY3QgYSBwcm9taXNlIG9ubHkgZnJvbSB0aGUgbWFpbiB0aHJlYWQuIFRoZSBjb2RlIGluY2x1ZGVzIGEgbGFyZ2UgbnVtYmVyIG9mIHVuc2FmZSBmdW5jdGlvbnMuYCksbWR4KCJwIixudWxsLG1keCgic3Ryb25nIix7cGFyZW50TmFtZToicCJ9LG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InN0cm9uZyJ9LGBmZWJgKSxgIGZ1bmN0aW9uYCkpLG1keCgicHJlIixudWxsLG1keCgiY29kZSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InByZSJ9LHt9KSxgcHViIHVuc2FmZSBleHRlcm4gIkMiIGZuIGZlYihlbnY6IG5hcGlfZW52LCBpbmZvOiBuYXBpX2NhbGxiYWNrX2luZm8pIC0+IG5hcGlfdmFsdWUgewogICAgbGV0IG11dCBidWZmZXI6IFZlYzxuYXBpX3ZhbHVlPiA9IFZlYzo6d2l0aF9jYXBhY2l0eSgxKTsKICAgIGxldCBwID0gYnVmZmVyLmFzX211dF9wdHIoKTsKICAgIGxldCBtdXQgYXJnYyA9IDEgYXMgdXNpemU7CiAgICBzdGQ6Om1lbTo6Zm9yZ2V0KGJ1ZmZlcik7Ci8vIGdldHRpbmcgYXJndW1lbnRzIGZvciB0aGUgZnVuY3Rpb24KICAgIG5hcGlfZ2V0X2NiX2luZm8oCiAgICAgICAgZW52LAogICAgICAgIGluZm8sCiAgICAgICAgJm11dCBhcmdjLAogICAgICAgIHAsCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICAgICAgc3RkOjpwdHI6Om51bGxfbXV0KCksCiAgICApOwogICAgbGV0IG11dCBzdGFydCA9IDA7Ci8vIGNvbnZlcnRpbmcgdGhlIG5hcGlfdmFsdWUgdG8gdTY0IG51bWJlcgogICAgbmFwaV9nZXRfdmFsdWVfaW50NjQoZW52LCAqcCwgJm11dCBzdGFydCk7Ci8vIHByb21pc2Ugd2hpY2ggd291bGQgYmUgcmV0dXJuZWQKICAgIGxldCBtdXQgcHJvbWlzZTogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKLy8gYSBwb2ludGVyIHRvIHByb21pc2UgdG8gcmVzb2x2ZSBpcyBvciByZWplY3QgaXQKICAgIGxldCBtdXQgZGVmZXJyZWQ6IG5hcGlfZGVmZXJyZWQgPSBzdGQ6Om1lbTo6emVyb2VkKCk7Ci8vIGEgcG9pbnRlciB0byBvdXIgYXN5bmMgd29yayBuYW1lIHVzZWQgZm9yIGRlYnVnZ2luZwogICAgbGV0IG11dCB3b3JrX25hbWU6IG5hcGlfdmFsdWUgPSBzdGQ6Om1lbTo6emVyb2VkKCk7Ci8vIHBvaW50ZXIgdG8gYXN5bmMgd29yawogICAgbGV0IG11dCB3b3JrOiBuYXBpX2FzeW5jX3dvcmsgPSBzdGQ6Om1lbTo6emVyb2VkKCk7CiAgICBsZXQgYXN5bmNfbmFtZSA9IENTdHJpbmc6Om5ldygiYXN5bmMgZmlib25hY2kiKS5leHBlY3QoIkVycm9yIGNyZWF0aW5nIHN0cmluZyIpOwovLyBjcmVhdGluZyBhIHN0cmluZyBmb3IgbmFtZQogICAgbmFwaV9jcmVhdGVfc3RyaW5nX3V0ZjgoZW52LCBhc3luY19uYW1lLmFzX3B0cigpLCAxMywgJm11dCB3b3JrX25hbWUpOwovLyBjcmVhdGluZyBhIHByb21pc2UKICAgIG5hcGlfY3JlYXRlX3Byb21pc2UoZW52LCAmbXV0IGRlZmVycmVkLCAmbXV0IHByb21pc2UpOwogICAgbGV0IHYgPSBEYXRhIHsKICAgICAgICBkZWZlcnJlZCwKICAgICAgICB3b3JrLAogICAgICAgIHZhbDogc3RhcnQgYXMgdTY0LAogICAgICAgIHJlc3VsdDogTm9uZSwKICAgIH07Ci8vIGNyZWF0aW5nIGEgY29udGV4dCB3aGljaCBjYW4gYmUgc2F2ZWQgdG8gc2hhcmUgc3RhdGUgYmV0d2VlbiBvdXIgZnVuY3Rpb25zCiAgICBsZXQgZGF0YSA9IEJveDo6bmV3KHYpOwovLyBjb252ZXJ0aW5nIGl0IHRvIHJhdyBwb2ludGVyCiAgICBsZXQgcmF3ID0gQm94OjppbnRvX3JhdyhkYXRhKTsKLy8gY3JlYXRpbmcgdGhlIHdvcmsKICAgIG5hcGlfY3JlYXRlX2FzeW5jX3dvcmsoCiAgICAgICAgZW52LAogICAgICAgIHN0ZDo6cHRyOjpudWxsX211dCgpLAogICAgICAgIHdvcmtfbmFtZSwKICAgICAgICBTb21lKHBlcmZvcm0pLAogICAgICAgIFNvbWUoY29tcGxldGUpLAogICAgICAgIHN0ZDo6bWVtOjp0cmFuc211dGUocmF3KSwKICAgICAgICAmbXV0IHdvcmssCiAgICApOwovLyBxdWV1aW5nIHRvIGV4ZWN1dGUgdGhlIHdvcmsKICAgIG5hcGlfcXVldWVfYXN5bmNfd29yayhlbnYsIHdvcmspOwovLyBzZXR0aW5nIHBvaW50ZXIgdG8gd29yayB0aGF0IGNhbiBiZSB1c2VkIGxhdGVyCiAgICAoKnJhdykud29yayA9IHdvcms7Ci8vIHJldHVuaW5nIHRoZSBwb3JtaXNlCiAgICBwcm9taXNlCn0KYCkpLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJzdHJvbmcifSxgcGVyZm9ybWApLGAgZnVuY3Rpb25gKSksbWR4KCJwcmUiLG51bGwsbWR4KCJjb2RlIixfZXh0ZW5kcyh7cGFyZW50TmFtZToicHJlIn0se30pLGBwdWIgdW5zYWZlIGV4dGVybiAiQyIgZm4gcGVyZm9ybShfZW52OiBuYXBpX2VudiwgZGF0YTogKm11dCBjX3ZvaWQpIHsKLy8gZ2V0dGluZyB0aGUgc2hhcmVkIGRhdGEgYW5kIGNvbnZlcnRpbmcgdGhlIGluIGJveAogICAgbGV0IG11dCB0OiBCb3g8RGF0YT4gPSBCb3g6OmZyb21fcmF3KHN0ZDo6bWVtOjp0cmFuc211dGUoZGF0YSkpOwogICAgbGV0IG11dCBsYXN0ID0gMTsKICAgIGxldCBtdXQgc2Vjb25kX2xhc3QgPSAwOwogICAgZm9yIF8gaW4gMi4udC52YWwgewogICAgICAgIGxldCB0ZW1wID0gbGFzdDsKICAgICAgICBsYXN0ID0gbGFzdCArIHNlY29uZF9sYXN0OwogICAgICAgIHNlY29uZF9sYXN0ID0gdGVtcDsKICAgIH0KLy8gc2V0dGluZyB0aGUgcmVzdWx0IG9uIHNoYXJlZCBjb250ZXh0CiAgICB0LnJlc3VsdCA9IFNvbWUoT2sobGFzdCkpOwovLyB0ZWxsaW5nIHRoZSBydXN0IHRvIG5vdCB0byBkcm9wIHRoZSBjb250ZXh0IGRhdGEKICAgIEJveDo6aW50b19yYXcodCk7Cn0KYCkpLG1keCgicCIsbnVsbCxtZHgoInN0cm9uZyIse3BhcmVudE5hbWU6InAifSxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJzdHJvbmcifSxgY29tcGxldGVgKSxgIEZ1bmN0aW9uYCkpLG1keCgicHJlIixudWxsLG1keCgiY29kZSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6InByZSJ9LHt9KSxgcHViIHVuc2FmZSBleHRlcm4gIkMiIGZuIGNvbXBsZXRlKGVudjogbmFwaV9lbnYsIF9zdGF0dXM6IG5hcGlfc3RhdHVzLCBkYXRhOiAqbXV0IGNfdm9pZCkgewovLyBnZXR0aW5nIHRoZSBzaGFyZWQgY29udGV4dAogICAgbGV0IHQ6IEJveDxEYXRhPiA9IEJveDo6ZnJvbV9yYXcoc3RkOjptZW06OnRyYW5zbXV0ZShkYXRhKSk7CiAgICBsZXQgdiA9IG1hdGNoIHRhc2sucmVzdWx0IHsKICAgICAgICBTb21lKGQpID0+IG1hdGNoIGQgewogICAgICAgICAgICBPayhyZXN1bHQpID0+IHJlc3VsdCwKICAgICAgICAgICAgRXJyKF8pID0+IHsKLy8gaWYgdGhlcmUgaXMgZXJyb3IganVzdCB0aHJvdyBhbiBlcnJvcgovLyBjcmVhdGluZyBlcnJvcgogICAgICAgICAgICAgICAgbGV0IG11dCBqc19lcnJvcjogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICAgICAgICAgIG5hcGlfY3JlYXRlX2Vycm9yKAogICAgICAgICAgICAgICAgICAgIGVudiwKICAgICAgICAgICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgICAgICAgICAmbXV0IGpzX2Vycm9yLAogICAgICAgICAgICAgICAgKTsKLy8gcmVqZWN0aW5nIHRoZSBwcm9taXNlIHdpdGggZXJyb3IKICAgICAgICAgICAgICAgIG5hcGlfcmVqZWN0X2RlZmVycmVkKGVudiwgdGFzay5kZWZlcnJlZCwganNfZXJyb3IpOwovLyBkZWxldGluZyB0aGUgdGFzayBmcm9tIHRoZSBxdWV1ZQogICAgICAgICAgICAgICAgbmFwaV9kZWxldGVfYXN5bmNfd29yayhlbnYsIHRhc2sud29yayk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIE5vbmUgPT4gewovLyBpZiBubyByZXN1bHQgaXMgZm91bmQgcmVqZWN0IHdpdGggZXJyb3IKLy8gY3JlYXRpbmcgYW4gZXJyb3IKICAgICAgICAgICAgbGV0IG11dCBqc19lcnJvcjogbmFwaV92YWx1ZSA9IHN0ZDo6bWVtOjp6ZXJvZWQoKTsKICAgICAgICAgICAgbmFwaV9jcmVhdGVfZXJyb3IoCiAgICAgICAgICAgICAgICBlbnYsCiAgICAgICAgICAgICAgICBzdGQ6OnB0cjo6bnVsbF9tdXQoKSwKICAgICAgICAgICAgICAgIHN0ZDo6cHRyOjpudWxsX211dCgpLAogICAgICAgICAgICAgICAgJm11dCBqc19lcnJvciwKICAgICAgICAgICAgKTsKLy8gcmVqZWN0aW5nIHByb21pc2Ugd2l0aCBlcnJvcgogICAgICAgICAgICBuYXBpX3JlamVjdF9kZWZlcnJlZChlbnYsIHRhc2suZGVmZXJyZWQsIGpzX2Vycm9yKTsKLy8gZGVsZXRpbmcgdGhlIHRhc2sgZnJvbSBxdWV1ZQogICAgICAgICAgICBuYXBpX2RlbGV0ZV9hc3luY193b3JrKGVudiwgdGFzay53b3JrKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH07Ci8vIGNyZWF0aW5nIHRoZSBudW1iZXIKICAgIGxldCBtdXQgb2JqOiBuYXBpX3ZhbHVlID0gc3RkOjptZW06Onplcm9lZCgpOwogICAgbmFwaV9jcmVhdGVfaW50NjQoZW52LCB2IGFzIGk2NCwgJm11dCBvYmopOwovLyByZXNvbHZpbmcgdGhlIHByb21pc2Ugd2l0aCByZXN1bHQKICAgIG5hcGlfcmVzb2x2ZV9kZWZlcnJlZChlbnYsIHQuZGVmZXJyZWQsIG9iaik7Ci8vIGRlbGV0aW5nIHRoZSB3b3JrCiAgICBuYXBpX2RlbGV0ZV9hc3luY193b3JrKGVudiwgdC53b3JrKTsKfQpgKSksbWR4KCJoMiIseyJpZCI6ImNvbmNsdXNpb24ifSxgQ29uY2x1c2lvbmApLG1keCgicCIsbnVsbCxgVGhpcyBpcyBqdXN0IHRoZSB0aXAgb2YgdGhlIGljZWJlcmcgd2hlbiBpdCBjb21lcyB0byB3aGF0IHlvdSBjYW4gZG8gd2l0aCBOLUFQSS4gV2Ugd2VudCBvdmVyIGEgZmV3IHBhdHRlcm5zIGFuZCBjb3ZlcmVkIHRoZSBiYXNpY3MsIHN1Y2ggYXMgaG93IHRvIGV4cG9ydCBmdW5jdGlvbiwgY3JlYXRlIG9mdC11c2VkIEphdmFTY3JpcHQgdHlwZXMgc3VjaCBhcyBzdHJpbmdzLCBudW1iZXJzLCBhcnJheXMsIG9iamVjdHMsIGV0Yy4sIGdldCB0aGUgY29udGV4dCBvZiBhIGZ1bmN0aW9uIChpLmUuLCBnZXQgdGhlIGFyZ3VtZW50cyBhbmQgYCxtZHgoImlubGluZUNvZGUiLHtwYXJlbnROYW1lOiJwIn0sYHRoaXNgKSxgIGluIGEgZnVuY3Rpb24pLCBldGMuYCksbWR4KCJwIixudWxsLGBXZSBhbHNvIGV4YW1pbmVkIGFuIGluLWRlcHRoIGV4YW1wbGUgb2YgaG93IHRvIHVzZSBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgbGlidXZgKSxgIHRocmVhZHMgYW5kIGNyZWF0ZSBhbiBgLG1keCgiaW5saW5lQ29kZSIse3BhcmVudE5hbWU6InAifSxgYXN5bmNfd29ya2ApLGAgdG8gcGVyZm9ybSBoZWF2eSBjYWxjdWxhdGlvbnMgaW4gdGhlIGJhY2tncm91bmQuIEZpbmFsbHksIHdlIGNyZWF0ZWQgYW5kIHVzZWQgSmF2YVNjcmlwdCdzIHByb21pc2VzIGFuZCBsZWFybmVkIGhvdyB0byBkbyBlcnJvciBoYW5kbGluZyBpbiBOLUFQSXMuYCksbWR4KCJwIixudWxsLGBUaGVyZSBhcmUgbWFueSBsaWJyYXJpZXMgYXZhaWxhYmxlIGlmIHlvdSBkb27igJl0IHdhbnQgdG8gd3JpdGUgYWxsIHRoZSBjb2RlIGJ5IGhhbmQuIFRoZXNlIHByb3ZpZGUgbmljZSBhYnN0cmFjdGlvbnMsIGJ1dCB0aGUgZG93bnNpZGUgaXMgdGhhdCB0aGV5IGRvbid0IHN1cHBvcnQgYWxsIGZlYXR1cmVzLmApLG1keCgidWwiLG51bGwsbWR4KCJsaSIse3BhcmVudE5hbWU6InVsIn0sbWR4KCJhIixfZXh0ZW5kcyh7cGFyZW50TmFtZToibGkifSx7ImhyZWYiOiJodHRwczovL2dpdGh1Yi5jb20vbmVvbi1iaW5kaW5ncy9uZW9uIn0pLGBub2VuYCkpLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6ImxpIn0seyJocmVmIjoiaHR0cHM6Ly9naXRodWIuY29tL2luZmlueW9uL25vZGUtYmluZGdlbiJ9KSxgbm9kZS1iaW5kZ2VuYCkpLG1keCgibGkiLHtwYXJlbnROYW1lOiJ1bCJ9LG1keCgiYSIsX2V4dGVuZHMoe3BhcmVudE5hbWU6ImxpIn0seyJocmVmIjoiaHR0cHM6Ly9naXRodWIuY29tL0Jyb29vb29va2x5bi9uYXBpLXJzIn0pLGBuYXBpLXJzYCkpKSk7fTtNRFhDb250ZW50LmlzTURYQ29tcG9uZW50PXRydWU7"},{"version":3,"sources":["/Users/inmatin/Desktop/anshulrgoyal/blog/2020-04-19-rust-and-nodejs.md"],"names":["React","mdx","frontMatter","id","title","author","author_url","author_image_url","tags","image","metadata","rightToc","value","children","layoutProps","MDXLayout","MDXContent","components","props","isMDXComponent"],"mappings":"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","sourcesContent":["\n  import React from 'react';\n  import { mdx } from '@mdx-js/react';\n\n  export const frontMatter = {\n\tid: 'nodejs-rust-match',\n\ttitle: 'Rust and Node.js: A match made in heaven',\n\tauthor: 'Anshul Goyal',\n\tauthor_url: 'https://github.com/anshulrgoyal',\n\tauthor_image_url: '/img/anshul.jpg',\n\ttags: [\n\t\t'rust',\n\t\t'nodejs'\n\t],\n\timage: 'https://paper-attachments.dropbox.com/s_3C11437A61A671DE930509E35F223D4A57F95F8B98F2408BFA72EA39228306E2_1587462711550_Untitled+design.png'\n};\nexport const metadata = {\n  \"permalink\": \"/blog/nodejs-rust-match\",\n  \"source\": \"@site/blog/2020-04-19-rust-and-nodejs.md\",\n  \"description\": \"Table of Contents\",\n  \"date\": \"2020-04-19T00:00:00.000Z\",\n  \"tags\": [\n    {\n      \"label\": \"rust\",\n      \"permalink\": \"/blog/tags/rust\"\n    },\n    {\n      \"label\": \"nodejs\",\n      \"permalink\": \"/blog/tags/nodejs\"\n    }\n  ],\n  \"title\": \"Rust and Node.js: A match made in heaven\",\n  \"readingTime\": 20.58,\n  \"truncated\": true,\n  \"prevItem\": {\n    \"title\": \"A beginners guide to gRPC with Rust\",\n    \"permalink\": \"/blog/grpc-rust\"\n  },\n  \"nextItem\": {\n    \"title\": \"Creating Forms In React With Formik And Yup\",\n    \"permalink\": \"/blog/react-formik\"\n  }\n};\n  /* @jsx mdx */\n\nexport const rightToc = [{\n  value: 'Table of Contents',\n  id: 'table-of-contents',\n  children: [{\n    value: 'This article was published at Log Rocket',\n    id: 'this-article-was-published-at-log-rocket',\n    children: []\n  }]\n}, {\n  value: 'What is Rust?',\n  id: 'what-is-rust',\n  children: []\n}, {\n  value: 'What is a native addon?',\n  id: 'what-is-a-native-addon',\n  children: []\n}, {\n  value: 'Where does Rust come in?',\n  id: 'where-does-rust-come-in',\n  children: []\n}, {\n  value: 'Setting up your project',\n  id: 'setting-up-your-project',\n  children: []\n}, {\n  value: 'Using the addon in Node.js',\n  id: 'using-the-addon-in-nodejs',\n  children: []\n}, {\n  value: 'A deep dive into N-API',\n  id: 'a-deep-dive-into-n-api',\n  children: []\n}, {\n  value: 'Working with promises and libuv thread pool',\n  id: 'working-with-promises-and-libuv-thread-pool',\n  children: []\n}, {\n  value: 'Conclusion',\n  id: 'conclusion',\n  children: []\n}];\n\nconst layoutProps = {\n  rightToc\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h2 {...{\n      \"id\": \"table-of-contents\"\n    }}>{`Table of Contents`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`Available Methods`}</li>\n      <li parentName=\"ol\">{`Native Addons`}</li>\n      <li parentName=\"ol\">{`Setting Of Project`}</li>\n      <li parentName=\"ol\">{`A deep dive in Napi`}</li>\n      <li parentName=\"ol\">{`Conclusion`}</li>\n    </ol>\n    {\n      /*truncate*/\n    }\n    <h3 {...{\n      \"id\": \"this-article-was-published-at-log-rocket\"\n    }}>{`This article was published at `}<a parentName=\"h3\" {...{\n        \"href\": \"https://blog.logrocket.com/rust-and-node-js-a-match-made-in-heaven/\"\n      }}>{`Log Rocket`}</a></h3>\n    <p>{`Node.js is a very popular JavaScript runtime for writing backend applications. Its flexibility and nonblocking nature have made it the premier choice for API consumption.`}</p>\n    <p>{`Since it is a scripting language, JavaScript can be pretty slow. But thanks to V8 optimization, it is fast enough for practical applications. That said, Node.js is not good for heavy lifting; since it’s single-threaded, it is dangerous to block the main thread for doing long calculations. That’s where `}<a parentName=\"p\" {...{\n        \"href\": \"https://blog.logrocket.com/node-js-multithreading-what-are-worker-threads-and-why-do-they-matter-48ab102f8b10/\"\n      }}>{`worker`}</a>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://blog.logrocket.com/node-js-multithreading-what-are-worker-threads-and-why-do-they-matter-48ab102f8b10/\"\n      }}></a><a parentName=\"p\" {...{\n        \"href\": \"https://blog.logrocket.com/node-js-multithreading-what-are-worker-threads-and-why-do-they-matter-48ab102f8b10/\"\n      }}>{`threads`}</a>{` come in. Node.js has support for worker threads, so it can be used to perform long calculations.`}</p>\n    <p>{`As great as worker threads are, JavaScript is still slow. Moreover, worker thread are not available in all supported LTS versions of Node. Fortunately, we can use Rust to build a native add-on for Node.js. FFI is another alternative, but it’s slower than the add-on approach. Rust is blazing fast and has fearless concurrency. Since Rust has a very small runtime (or \"not runtime\"), our binary size should also be pretty small.`}</p>\n    <h2 {...{\n      \"id\": \"what-is-rust\"\n    }}>{`What is Rust?`}</h2>\n    <p>{`Rust is a systems programming language by Mozilla. It can call the C library by default and includes first-class support for exporting functions to C.`}</p>\n    <p>{`Rust provides you with low-level control and high-level ergonomics. It gives you control of memory management without the hassle associated with these controls. It also delivers zero-cost abstraction, so you pay for only what you use.`}</p>\n    <p>{`Rust can be called in a Node.js context via various methods. I’ve listed some of the most widely used below.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`You can use FFI from Node.js and Rust, but this is very slow`}</li>\n      <li parentName=\"ul\">{`You can use WebAssembly to create a `}<inlineCode parentName=\"li\">{`node_module`}</inlineCode>{`, but all Node.js functionality is not available`}</li>\n      <li parentName=\"ul\">{`You can use native addons`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"what-is-a-native-addon\"\n    }}>{`What is a native addon?`}</h2>\n    <p>{`Node.js addons are shared objects written in C++ that are dynamically linked. You can load them into Node.js using the `}<inlineCode parentName=\"p\">{`require()`}</inlineCode>{` function and use them as if they were ordinary Node.js modules. They primarily provide an interface between JavaScript running in Node.js and C/C++ libraries.`}</p>\n    <p>{`A native addon provides a simple interface to work with another binary by loading it in V8 runtime. It is very fast and safe for making calls across the languages. Currently, Node.js supports two types of addon methods: C++ addons and N-API C++/C addons.`}</p>\n    <p><strong parentName=\"p\">{`C++ Addons`}</strong></p>\n    <p>{`A C++ addon is an object that can be mounted by Node.js and used in the runtime. Since C++ is a compiled language, these addons are very fast. C++ has a wide array of production-ready libraries that can be used to expand the Node.js ecosystem. Many popular libraries use native addons to improve performance and code quality.`}</p>\n    <p><strong parentName=\"p\">{`N-API`}</strong>{` `}<strong parentName=\"p\">{`C++/C Addons`}</strong></p>\n    <p>{`The main problem with C++ addons is that you need to compile them again with every change to underlying JavaScript runtime. It causes a problem with maintaining the addon. N-API tries to eliminate this, by introducing a standard ABI (Application Binary Interface). The C header file remains backward compatible. That means the addon compiled for a particular version of Node.js, can be used with any version greater than the version of Node.js it was compiled for. You would use this method to implement your addon.`}</p>\n    <h2 {...{\n      \"id\": \"where-does-rust-come-in\"\n    }}>{`Where does Rust come in?`}</h2>\n    <p>{`Rust can mimic the behavior of a C library. In other words, it exports the function in a format the C can understand and use. Rust calls the C function to access and use APIs provided by the Node.js. These APIs provide methods for creating JavaScript strings, arrays, numbers, error, objects, functions, and more. But we need to tell Rust what these external functions, structs, pointers, etc. look like.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`#[repr(C)]\nstruct MyRustStruct {\n    a: i32,\n}\nextern \"C\" fn rust_world_callback(target: *mut RustObject, a: i32) {\n    println!(\"Function is called from C world\", a);\n    unsafe {\n        // Do something on rust struct\n        (*target).a = a;\n    }\n}\nextern {\n   fn register_callback(target: *mut MyRustStruct,\n                        cb: extern fn(*mut MyRustStruct, i32)) -> i32;\n   fn trigger_callback();\n}\n`}</code></pre>\n    <p>{`Rust lays down the structs in memory differently, so we need to tell it to use the style C uses. It would a pain to create these functions by hand, so we’ll use a crate called `}<inlineCode parentName=\"p\">{`nodejs-sys`}</inlineCode>{` that uses `}<inlineCode parentName=\"p\">{`bindgen`}</inlineCode>{` to create a nice definition for N-API.`}</p>\n    <p><inlineCode parentName=\"p\">{`b\\`\\`indgen`}</inlineCode>{` automatically generates Rust FFI bindings to C and C++ libraries.`}</p>\n    <p>{`Note: There will a lot of unsafe code ahead, mostly external function calls.`}</p>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://dev-to-uploads.s3.amazonaws.com/i/4rgbnohg8ly3hb5g1vac.gif\",\n        \"alt\": \"Joker\"\n      }}></img></p>\n    <h2 {...{\n      \"id\": \"setting-up-your-project\"\n    }}>{`Setting up your project`}</h2>\n    <p>{`For this tutorial, you must have `}<a parentName=\"p\" {...{\n        \"href\": \"https://nodejs.org/\"\n      }}>{`Node.js`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.rust-lang.org/\"\n      }}>{`Rust`}</a>{` installed on your system, with `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/rust-lang/cargo/\"\n      }}>{`Cargo`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.npmjs.com/\"\n      }}>{`NPM`}</a>{`. I would suggest using `}<a parentName=\"p\" {...{\n        \"href\": \"https://rustup.rs/\"\n      }}>{`Rustup`}</a>{` to install Rust and `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/nvm-sh/nvm\"\n      }}>{`nvm`}</a>{` for Node.js.`}</p>\n    <p>{`Create a directory named `}<inlineCode parentName=\"p\">{`rust-addon`}</inlineCode>{` and initialize a new npm project by running `}<inlineCode parentName=\"p\">{`npm init`}</inlineCode>{`. Next, init a cargo project called `}<inlineCode parentName=\"p\">{`cargo init --lib`}</inlineCode>{`. Your project directory should look like this:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`├── Cargo.toml\n├── package.json\n└── src\n    └── lib.rs\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Configuring Rust to compile to the addon`}</strong></p>\n    <p>{`We need Rust to compile to a dynamic C library or object. Configure cargo to compile to the `}<inlineCode parentName=\"p\">{`.so`}</inlineCode>{` file on Linux, `}<inlineCode parentName=\"p\">{`.dylib`}</inlineCode>{` on OS X, and `}<inlineCode parentName=\"p\">{`.dll`}</inlineCode>{` on Windows. Rust can produce many different types of libraries using Rustc flags or Cargo.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`[package]\nname = \"rust-addon\"\nversion = \"0.1.0\"\nauthors = [\"Anshul Goyal <anshulgoel151999@gmail.com>\"]\nedition = \"2018\"\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n\n[lib]\ncrate-type=[\"cdylib\"]\n\n[dependencies]\nnodejs-sys = \"0.2.0\"\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`lib`}</inlineCode>{` key provides options to configure Rustc. The `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` key gives the library name to the shared object in the form of `}<inlineCode parentName=\"p\">{`lib{name}`}</inlineCode>{`, while `}<inlineCode parentName=\"p\">{`type`}</inlineCode>{` provides the type of library it should be compiled to — e.g., `}<inlineCode parentName=\"p\">{`cdylib`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`rlib`}</inlineCode>{`, etc. `}<inlineCode parentName=\"p\">{`cdylib`}</inlineCode>{` creates a dynamically linked C library. This shared object behaves like a C library.`}</p>\n    <p><strong parentName=\"p\">{`Starting with`}</strong>{` `}<strong parentName=\"p\">{`N-API`}</strong></p>\n    <p>{`Let’s create our N-API library. We need to add a dependency. `}<inlineCode parentName=\"p\">{`nodejs-sys`}</inlineCode>{` provides us with the binding required for `}<inlineCode parentName=\"p\">{`napi-header`}</inlineCode>{` files. `}<inlineCode parentName=\"p\">{`napi_register_module_v1`}</inlineCode>{` is the entry point for the addon. `}<a parentName=\"p\" {...{\n        \"href\": \"https://nodejs.org/api/n-api.html#n_api_module_registration\"\n      }}>{`N`}</a><a parentName=\"p\" {...{\n        \"href\": \"https://nodejs.org/api/n-api.html#n_api_module_registration\"\n      }}>{`-`}</a><a parentName=\"p\" {...{\n        \"href\": \"https://nodejs.org/api/n-api.html#n_api_module_registration\"\n      }}>{`API documentation`}</a>{` recommends `}<inlineCode parentName=\"p\">{`N-API\\`\\`_MODULE_INIT`}</inlineCode>{` macro for module registration which compiles to `}<inlineCode parentName=\"p\">{`napi_register_module_v1`}</inlineCode>{` function.`}</p>\n    <p>{`Node.js calls this function and provides it with an opaque pointer called `}<inlineCode parentName=\"p\">{`napi_env`}</inlineCode>{`, which refers to the configuration of the module in JavaScript runtime, and `}<inlineCode parentName=\"p\">{`napi_value`}</inlineCode>{`. The latter is another opaque pointer that represents a JavaScript value, which, in reality is an object known as an export. These exports are the same as those the `}<inlineCode parentName=\"p\">{`require`}</inlineCode>{` function provides to the Node.js modules in JavaScript.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`use nodejs_sys::{napi_create_string_utf8, napi_env, napi_set_named_property, napi_value};\nuse std::ffi::CString;\n#[no_mangle]\npub unsafe extern \"C\" fn napi_register_module_v1(\n    env: napi_env,\n    exports: napi_value,\n) -> nodejs_sys::napi_value {\n// creating a C string\n    let key = CString::new(\"hello\").expect(\"CString::new failed\");\n// creating a memory location where the pointer to napi_value will be saved\n    let mut local: napi_value = std::mem::zeroed();\n// creating a C string\n    let value = CString::new(\"world!\").expect(\"CString::new failed\");\n// creating napi_value for the string\n    napi_create_string_utf8(env, value.as_ptr(), 6, &mut local);\n// setting the string on the exports object\n    napi_set_named_property(env, exports, key.as_ptr(), local);\n// returning the object\n    exports\n}\n`}</code></pre>\n    <p>{`Rust represents owned strings with the `}<inlineCode parentName=\"p\">{`S\\`\\`tring`}</inlineCode>{` type and borrowed slices of strings with the `}<inlineCode parentName=\"p\">{`str`}</inlineCode>{` primitive. Both are always in UTF-8 encoding and may contain null bytes in the middle. If you look at the bytes that make up the string, there may be a `}<inlineCode parentName=\"p\">{`\\\\0`}</inlineCode>{` among them. Both `}<inlineCode parentName=\"p\">{`String`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`str`}</inlineCode>{` store their length explicitly; there are no null terminators at the end of strings like C strings.`}</p>\n    <p>{`Rust strings are very different from the ones in C, so we need to change our Rust strings to C strings before we can use then with N-API functions. Since exports is an object represented by `}<inlineCode parentName=\"p\">{`exports`}</inlineCode>{`, we can add functions, strings, arrays, or any other JavaScript objects as key-value pairs.`}</p>\n    <p>{`To add a key to a JavaScript object, you can use a method provided by the N-API `}<inlineCode parentName=\"p\">{`napi_set_named_property`}</inlineCode>{`. This function takes the object to which we want to add a property; a pointer to a string that will be used as the key for our property; the pointer to the JavaScript value, which can be a string, array, etc.; and `}<inlineCode parentName=\"p\">{`napi_env`}</inlineCode>{`, which acts an anchor between Rust and Node.js.`}</p>\n    <p>{`You can use N-API functions to create any JavaScript value. For example, we used `}<inlineCode parentName=\"p\">{`napi_create_string_utf8`}</inlineCode>{` here to create a string. We passed in the environment a pointer to the string, the length of string, and a pointer to an empty memory location where it can write the pointer to the newly created value. All this code is unsafe because it includes many calls to external functions where the compiler cannot provide Rust guarantees. In the end, we returned the module that was provided to us by setting a property on it with the value `}<inlineCode parentName=\"p\">{`world!`}</inlineCode>{`.`}</p>\n    <p>{`It’s important to understand that `}<inlineCode parentName=\"p\">{`nodejs-sys`}</inlineCode>{` just provides the required definitions for the function you’re using, not their implementation. N-API implementation is included with Node.js and you call it from your Rust code.`}</p>\n    <h2 {...{\n      \"id\": \"using-the-addon-in-nodejs\"\n    }}>{`Using the addon in Node.js`}</h2>\n    <p>{`The next step is to add a linking configuration for different operating systems, then you can compile it.`}</p>\n    <p>{`Create a `}<inlineCode parentName=\"p\">{`build.rs`}</inlineCode>{` file to add a few configuration flags for linking the N-API files on different operating systems.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`fn main() {\n    println!(\"cargo:rustc-cdylib-link-arg=-undefined\");\n    if cfg!(target_os = \"macos\") {\n        println!(\"cargo:rustc-cdylib-link-arg=dynamic_lookup\");\n    }\n}\n`}</code></pre>\n    <p>{`Your directory should look like this:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`├── build.rs\n├── Cargo.lock\n├── Cargo.toml\n├── index.node\n├── package.json\n├── src\n    └── lib.rs\n`}</code></pre>\n    <p>{`Now you need to compile your Rust addon. You can do so pretty easily using the simple command `}<inlineCode parentName=\"p\">{`cargo build --release`}</inlineCode>{`. This will take some time on the first run.`}</p>\n    <p>{`After your module is compiled, create a copy of this binary from `}<inlineCode parentName=\"p\">{`./target/release/libnative.so`}</inlineCode>{` to your root directory and rename it as `}<inlineCode parentName=\"p\">{`index.node`}</inlineCode>{`. The binary created by the cargo may have a different extension or name, depending on your crate setting and operating system.`}</p>\n    <p>{`Now you can require the file in Node.js and use it. You can also use it in a script. For example:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`let addon=require('./index.node');\nconsole.log(addon.hello);\n`}</code></pre>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://dev-to-uploads.s3.amazonaws.com/i/ozbxwwmm6680oz97v5ds.png\",\n        \"alt\": \"Example\"\n      }}></img></p>\n    <p>{`Next, we’ll move on to creating functions, arrays, and promises and using `}<inlineCode parentName=\"p\">{`libuv thread-pool`}</inlineCode>{` to perform heavy tasks without blocking the main thread.`}</p>\n    <h2 {...{\n      \"id\": \"a-deep-dive-into-n-api\"\n    }}>{`A deep dive into N-API`}</h2>\n    <p>{`Now you know how to implement common patterns using N-API and Rust. A very common pattern is the export function, which can be called by the user of the library or Node module. Let’s start by creating a function.`}</p>\n    <p>{`You should use `}<inlineCode parentName=\"p\">{`napi_create_function`}</inlineCode>{` to create your functions so that you can use them from Node.js. You can add these functions as a property to exports to use from Node.js.`}</p>\n    <p><strong parentName=\"p\">{`Creating a function`}</strong></p>\n    <p>{`JavaScript functions are also represented by the `}<inlineCode parentName=\"p\">{`napi_value`}</inlineCode>{` pointer. A N-API function is pretty easy to create and use.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`use nodejs_sys::{\n    napi_callback_info, napi_create_function, napi_create_string_utf8, napi_env,\n    napi_set_named_property, napi_value,\n};\nuse std::ffi::CString;\npub unsafe extern \"C\" fn say_hello(env: napi_env, _info: napi_callback_info) -> napi_value {\n// creating  a javastring string\n    let mut local: napi_value = std::mem::zeroed();\n    let p = CString::new(\"Hello from rust\").expect(\"CString::new    failed\");\n    napi_create_string_utf8(env, p.as_ptr(), 13, &mut local);\n// returning the javascript string\n    local\n}\n#[no_mangle]\npub unsafe extern \"C\" fn napi_register_module_v1(\n    env: napi_env,\n    exports: napi_value,\n) -> nodejs_sys::napi_value {\n// creating a C String\n    let p = CString::new(\"myFunc\").expect(\"CString::new failed\");\n// creating a location where pointer to napi_value be written\n    let mut local: napi_value = std::mem::zeroed();\n    napi_create_function(\n        env,\n// pointer to function name\n        p.as_ptr(),\n// length of function name\n        5,\n// rust function\n        Some(say_hello),\n// context which can be accessed by the rust function\n        std::ptr::null_mut(),\n// output napi_value\n        &mut local,\n    );\n// set function as property\n    napi_set_named_property(env, exports, p.as_ptr(), local);\n// returning exports\n    exports\n}\n`}</code></pre>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://dev-to-uploads.s3.amazonaws.com/i/cfzmn20r0doiuhdgqaq3.png\",\n        \"alt\": \"Example\"\n      }}></img></p>\n    <p>{`In the above example, we created a function in Rust named `}<inlineCode parentName=\"p\">{`say_hello`}</inlineCode>{`, which is executed when the JavaScript calls the function. We created a function using `}<inlineCode parentName=\"p\">{`napi_create_function`}</inlineCode>{`, which takes the following arguments:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The `}<inlineCode parentName=\"li\">{`napi_env`}</inlineCode>{` value of the environment`}</li>\n      <li parentName=\"ul\">{`A string for the function name which that be given to the JavaScript function`}</li>\n      <li parentName=\"ul\">{`The length of the function name string`}</li>\n      <li parentName=\"ul\">{`The function that is executed when the JavaScript calls the newly created function`}</li>\n      <li parentName=\"ul\">{`Context data that can be passed by the user later and accessed from the Rust function`}</li>\n      <li parentName=\"ul\">{`An empty memory address where the pointer to the JavaScript function can be saved`}</li>\n      <li parentName=\"ul\">{`When you create this function, add it as a property to your `}<inlineCode parentName=\"li\">{`exports`}</inlineCode>{` object so that you can use it from JavaScript`}</li>\n    </ul>\n    <p>{`The function on the Rust side must have the same signature as shown in the example. We’ll discuss next how to access arguments inside a function using `}<inlineCode parentName=\"p\">{`napi_callback_info`}</inlineCode>{`. We can access this from a function and other arguments as well.`}</p>\n    <p><strong parentName=\"p\">{`Accessing`}</strong>{` `}<strong parentName=\"p\">{`arguments`}</strong></p>\n    <p>{`Function arguments are very important. N-API provides a method to access these arguments. `}<inlineCode parentName=\"p\">{`napi_callback_info`}</inlineCode>{` provides the pointer with detailed information about the function in the JavaScript side of the code.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`use nodejs_sys::{\n    napi_callback_info, napi_create_double, napi_create_function, napi_env, napi_get_cb_info,\n    napi_get_value_double, napi_set_named_property, napi_value,\n};\nuse std::ffi::CString;\n\npub unsafe extern \"C\" fn add(env: napi_env, info: napi_callback_info) -> napi_value {\n// creating a buffer where napi_value of argument be written\n    let mut buffer: [napi_value; 2] = std::mem::MaybeUninit::zeroed().assume_init();\n// max number of arguments\n    let mut argc = 2 as usize;\n// getting arguments and value of this\n    napi_get_cb_info(\n        env,\n        info,\n        &mut argc,\n        buffer.as_mut_ptr(),\n        std::ptr::null_mut(),\n        std::ptr::null_mut(),\n    );\n// converting napi to f64\n    let mut x = 0 as f64;\n    let mut y = 0 as f64;\n    napi_get_value_double(env, buffer[0], &mut x);\n    napi_get_value_double(env, buffer[1], &mut y);\n// creating the return value\n    let mut local: napi_value = std::mem::zeroed();\n    napi_create_double(env, x + y, &mut local);\n// returning the result\n    local\n}\n\n#[no_mangle]\npub unsafe extern \"C\" fn napi_register_module_v1(\n    env: napi_env,\n    exports: napi_value,\n) -> nodejs_sys::napi_value {\n// creating a function name\n    let p = CString::new(\"myFunc\").expect(\"CString::new failed\");\n    let mut local: napi_value = std::mem::zeroed();\n// creating the function\n    napi_create_function(\n        env,\n        p.as_ptr(),\n        5,\n        Some(add),\n        std::ptr::null_mut(),\n        &mut local,\n    );\n// setting function as property\n    napi_set_named_property(env, exports, p.as_ptr(), local);\n// returning exports\n    exports\n}\n`}</code></pre>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://dev-to-uploads.s3.amazonaws.com/i/u3r2j1xw1oh43jr8gygv.png\",\n        \"alt\": \"Example\"\n      }}></img></p>\n    <p>{`Use `}<inlineCode parentName=\"p\">{`napi_get_cb_info`}</inlineCode>{` to get the arguments. The following arguments must be provided:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`napi_env`}</inlineCode></li>\n      <li parentName=\"ul\">{`The info pointer`}</li>\n      <li parentName=\"ul\">{`The number of expected arguments`}</li>\n      <li parentName=\"ul\">{`A buffer where arguments can be written as `}<inlineCode parentName=\"li\">{`napi_value`}</inlineCode></li>\n      <li parentName=\"ul\">{`A memory location to store metadata the user provided when JavaScript function was created`}</li>\n      <li parentName=\"ul\">{`A memory location where this value pointer can be written`}</li>\n    </ul>\n    <p>{`We need to create an array with memory locations where C can write a pointer to arguments and we can pass this pointer buffer to N-API function. We also get `}<inlineCode parentName=\"p\">{`this`}</inlineCode>{`, but we aren’t using it in this example.`}</p>\n    <p><strong parentName=\"p\">{`Working with strings arguments`}</strong></p>\n    <p>{`Most of the time, you need to work with strings in JavaScript. Both creating and getting the value of a string are pretty straightforward. Use `}<inlineCode parentName=\"p\">{`napi_get_value_string_utf8`}</inlineCode>{` and call this function twice: the first time to get length and second time to get the value of the string.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`use nodejs_sys::{\n    napi_callback_info, napi_create_function, napi_env, napi_get_cb_info, napi_get_undefined,\n    napi_get_value_string_utf8, napi_set_named_property, napi_value,\n};\n\nuse std::ffi::CString;\n\npub unsafe extern \"C\" fn print(env: napi_env, info: napi_callback_info) -> napi_value {\n// creating a buffer of arguments\n    let mut buffer: [napi_value; 1] = std::mem::MaybeUninit::zeroed().assume_init();\n    let mut argc = 1 as usize;\n// getting arguments\n    napi_get_cb_info(\n        env,\n        info,\n        &mut argc,\n        buffer.as_mut_ptr(),\n        std::ptr::null_mut(),\n        std::ptr::null_mut(),\n    );\n    let mut len = 0;\n// getting length by passing null buffer\n    napi_get_value_string_utf8(env, buffer[0], std::ptr::null_mut(), 0, &mut len);\n    let size = len as usize;\n// creating a buffer where string can be placed\n    let mut ve: Vec<u8> = Vec::with_capacity(size + 1);\n    let raw = ve.as_mut_ptr();\n// telling rust not manage the vector\n    std::mem::forget(ve);\n    let mut cap = 0;\n// getting the string value from napi_value\n    let _s = napi_get_value_string_utf8(env, buffer[0], raw as *mut i8, size + 1, &mut cap);\n    let s = String::from_raw_parts(raw, cap as usize, size);\n// printing the string\n    println!(\"{}\", s);\n// creating an undefined\n    let mut und: napi_value = std::mem::zeroed();\n    napi_get_undefined(env, &mut und);\n// returning undefined\n    und\n}\n\n#[no_mangle]\npub unsafe extern \"C\" fn napi_register_module_v1(\n    env: napi_env,\n    exports: napi_value,\n) -> nodejs_sys::napi_value {\n    let p = CString::new(\"myFunc\").expect(\"CString::new failed\");\n    let mut local: napi_value = std::mem::zeroed();\n    napi_create_function(\n        env,\n        p.as_ptr(),\n        5,\n        Some(print),\n        std::ptr::null_mut(),\n        &mut local,\n    );\n    napi_set_named_property(env, exports, p.as_ptr(), local);\n    exports\n}\n`}</code></pre>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://dev-to-uploads.s3.amazonaws.com/i/zbk15csxak95qvnd2tcg.png\",\n        \"alt\": \"Example\"\n      }}></img></p>\n    <p>{`You’ll need to pass a few arguments to `}<inlineCode parentName=\"p\">{`napi_create_string_utf8`}</inlineCode>{` to create a string. If a null pointer is passed as buffer, the length of the string is given. The following arguments are required:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`napi_env`}</inlineCode></li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`napi_value`}</inlineCode>{` pointer to the string in `}<inlineCode parentName=\"li\">{`javascript side`}</inlineCode></li>\n      <li parentName=\"ul\">{`The buffer where the string is to be written if null gives the length of the string`}</li>\n      <li parentName=\"ul\">{`The length of the buffer`}</li>\n      <li parentName=\"ul\">{`Bytes written to the buffer`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"working-with-promises-and-libuv-thread-pool\"\n    }}>{`Working with promises and libuv thread pool`}</h2>\n    <p>{`It’s not a good idea to block the main thread of Node.js for doing calculations. You can use libuv threads to do the heavy lifting.`}</p>\n    <p>{`First, create a promise. The promise will reject or resolve based on the success of your work. For this, you’ll need to create three functions. The first one is called from the JavaScript world and the control would be passed to the second function, which runs on libuv thread and has no access to JavaScript. The third function, which does have access to the JavaScript side, is called after the second finishes. You can use the `}<inlineCode parentName=\"p\">{`napi_create_async_work`}</inlineCode>{` method for the libuv thread.`}</p>\n    <p><strong parentName=\"p\">{`Creating a promise`}</strong></p>\n    <p>{`To create a promise, simply use `}<inlineCode parentName=\"p\">{`napi_create_promise`}</inlineCode>{`. This will provide a pointer, `}<inlineCode parentName=\"p\">{`napi_deferred`}</inlineCode>{`, which can then resolve or reject a promise using the following functions:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`napi_resolve_deferred`}</inlineCode></li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`napi_reject_deferred`}</inlineCode></li>\n    </ul>\n    <p><strong parentName=\"p\">{`Error handling`}</strong></p>\n    <p>{`You can create and throw an error from the Rust code using `}<inlineCode parentName=\"p\">{`napi_create_error`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`napi_throw_error`}</inlineCode>{`. Every N-API function returns a `}<inlineCode parentName=\"p\">{`napi_status`}</inlineCode>{`, which should be checked.`}</p>\n    <p><strong parentName=\"p\">{`Real code`}</strong></p>\n    <p>{`The following example shows how to schedule async work.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-rust\"\n      }}>{`    use nodejs_sys::{\n        napi_async_work, napi_callback_info, napi_create_async_work, napi_create_error,\n        napi_create_function, napi_create_int64, napi_create_promise, napi_create_string_utf8,\n        napi_deferred, napi_delete_async_work, napi_env, napi_get_cb_info, napi_get_value_int64,\n        napi_queue_async_work, napi_reject_deferred, napi_resolve_deferred, napi_set_named_property,\n        napi_status, napi_value,\n    };\n    use std::ffi::c_void;\n    use std::ffi::CString;\n\n    #[derive(Debug, Clone)]\n    struct Data {\n        deferred: napi_deferred,\n        work: napi_async_work,\n        val: u64,\n        result: Option<Result<u64, String>>,\n    }\n\n    pub unsafe extern \"C\" fn feb(env: napi_env, info: napi_callback_info) -> napi_value {\n        let mut buffer: Vec<napi_value> = Vec::with_capacity(1);\n        let p = buffer.as_mut_ptr();\n        let mut argc = 1 as usize;\n        std::mem::forget(buffer);\n        napi_get_cb_info(\n            env,\n            info,\n            &mut argc,\n            p,\n            std::ptr::null_mut(),\n            std::ptr::null_mut(),\n        );\n        let mut start = 0;\n        napi_get_value_int64(env, *p, &mut start);\n        let mut promise: napi_value = std::mem::zeroed();\n        let mut deferred: napi_deferred = std::mem::zeroed();\n        let mut work_name: napi_value = std::mem::zeroed();\n        let mut work: napi_async_work = std::mem::zeroed();\n        let async_name = CString::new(\"async fibonaci\").expect(\"Error creating string\");\n        napi_create_string_utf8(env, async_name.as_ptr(), 13, &mut work_name);\n        napi_create_promise(env, &mut deferred, &mut promise);\n        let v = Data {\n            deferred,\n            work,\n            val: start as u64,\n            result: None,\n        };\n        let data = Box::new(v);\n        let raw = Box::into_raw(data);\n        napi_create_async_work(\n            env,\n            std::ptr::null_mut(),\n            work_name,\n            Some(perform),\n            Some(complete),\n            std::mem::transmute(raw),\n            &mut work,\n        );\n        napi_queue_async_work(env, work);\n        (*raw).work = work;\n        promise\n    }\n\n    pub unsafe extern \"C\" fn perform(_env: napi_env, data: *mut c_void) {\n        let mut t: Box<Data> = Box::from_raw(std::mem::transmute(data));\n        let mut last = 1;\n        let mut second_last = 0;\n        for _ in 2..t.val {\n            let temp = last;\n            last = last + second_last;\n            second_last = temp;\n        }\n        t.result = Some(Ok(last));\n        Box::into_raw(task);\n    }\n\n    pub unsafe extern \"C\" fn complete(env: napi_env, _status: napi_status, data: *mut c_void) {\n        let t: Box<Data> = Box::from_raw(std::mem::transmute(data));\n        let v = match t.result {\n            Some(d) => match d {\n                Ok(result) => result,\n                Err(_) => {\n                    let mut js_error: napi_value = std::mem::zeroed();\n                    napi_create_error(\n                        env,\n                        std::ptr::null_mut(),\n                        std::ptr::null_mut(),\n                        &mut js_error,\n                    );\n                    napi_reject_deferred(env, t.deferred, js_error);\n                    napi_delete_async_work(env, t.work);\n                    return;\n                }\n            },\n            None => {\n                let mut js_error: napi_value = std::mem::zeroed();\n                napi_create_error(\n                    env,\n                    std::ptr::null_mut(),\n                    std::ptr::null_mut(),\n                    &mut js_error,\n                );\n                napi_reject_deferred(env, t.deferred, js_error);\n                napi_delete_async_work(env, t.work);\n                return;\n            }\n        };\n        let mut obj: napi_value = std::mem::zeroed();\n        napi_create_int64(env, v as i64, &mut obj);\n        napi_resolve_deferred(env, t.deferred, obj);\n\n        napi_delete_async_work(env, t.work);\n    }\n\n    #[no_mangle]\n    pub unsafe extern \"C\" fn napi_register_module_v1(\n        env: napi_env,\n        exports: napi_value,\n    ) -> nodejs_sys::napi_value {\n        let p = CString::new(\"myFunc\").expect(\"CString::new failed\");\n        let mut local: napi_value = std::mem::zeroed();\n        napi_create_function(\n            env,\n            p.as_ptr(),\n            5,\n            Some(feb),\n            std::ptr::null_mut(),\n            &mut local,\n        );\n        napi_set_named_property(env, exports, p.as_ptr(), local);\n        exports\n    }\n`}</code></pre>\n    <p>{`We created a struct to store a pointer to our `}<inlineCode parentName=\"p\">{`napi_async_work`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`napi_deferred`}</inlineCode>{` as well as our output. Initially, the output is `}<inlineCode parentName=\"p\">{`None`}</inlineCode>{`. Then we created a promise, which provides a `}<inlineCode parentName=\"p\">{`deferred`}</inlineCode>{` that we save in our data. This data is available to us in all of our functions. Next, we converted our data into raw data and pass it to the `}<inlineCode parentName=\"p\">{`napi_create_async_work`}</inlineCode>{` function with other callbacks. We returned the promise we created, executed `}<inlineCode parentName=\"p\">{`perform`}</inlineCode>{`, and converted our data back to struct. Once `}<inlineCode parentName=\"p\">{`perform`}</inlineCode>{` is completed on libuv thread, `}<inlineCode parentName=\"p\">{`complete`}</inlineCode>{` is called from the main thread, along with the status of the previous operation and our data. Now we can reject or resolve our work and delete work from the queue.`}</p>\n    <p><strong parentName=\"p\">{`Lets walk through the code`}</strong></p>\n    <p>{`Create a function called `}<inlineCode parentName=\"p\">{`feb`}</inlineCode>{`, which will be exported to JavaScript. This function will return a promise and schedule work for the libuv thread pool. You can achieve this by creating a promise, using `}<inlineCode parentName=\"p\">{`napi_create_async_work`}</inlineCode>{`, and passing two functions to it. One is executed on the libuv thread and the other on the main thread. Since you can only execute JavaScript from the main thread, you must resolve or reject a promise only from the main thread. The code includes a large number of unsafe functions.`}</p>\n    <p><strong parentName=\"p\"><inlineCode parentName=\"strong\">{`feb`}</inlineCode>{` function`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`pub unsafe extern \"C\" fn feb(env: napi_env, info: napi_callback_info) -> napi_value {\n    let mut buffer: Vec<napi_value> = Vec::with_capacity(1);\n    let p = buffer.as_mut_ptr();\n    let mut argc = 1 as usize;\n    std::mem::forget(buffer);\n// getting arguments for the function\n    napi_get_cb_info(\n        env,\n        info,\n        &mut argc,\n        p,\n        std::ptr::null_mut(),\n        std::ptr::null_mut(),\n    );\n    let mut start = 0;\n// converting the napi_value to u64 number\n    napi_get_value_int64(env, *p, &mut start);\n// promise which would be returned\n    let mut promise: napi_value = std::mem::zeroed();\n// a pointer to promise to resolve is or reject it\n    let mut deferred: napi_deferred = std::mem::zeroed();\n// a pointer to our async work name used for debugging\n    let mut work_name: napi_value = std::mem::zeroed();\n// pointer to async work\n    let mut work: napi_async_work = std::mem::zeroed();\n    let async_name = CString::new(\"async fibonaci\").expect(\"Error creating string\");\n// creating a string for name\n    napi_create_string_utf8(env, async_name.as_ptr(), 13, &mut work_name);\n// creating a promise\n    napi_create_promise(env, &mut deferred, &mut promise);\n    let v = Data {\n        deferred,\n        work,\n        val: start as u64,\n        result: None,\n    };\n// creating a context which can be saved to share state between our functions\n    let data = Box::new(v);\n// converting it to raw pointer\n    let raw = Box::into_raw(data);\n// creating the work\n    napi_create_async_work(\n        env,\n        std::ptr::null_mut(),\n        work_name,\n        Some(perform),\n        Some(complete),\n        std::mem::transmute(raw),\n        &mut work,\n    );\n// queuing to execute the work\n    napi_queue_async_work(env, work);\n// setting pointer to work that can be used later\n    (*raw).work = work;\n// retuning the pormise\n    promise\n}\n`}</code></pre>\n    <p><strong parentName=\"p\"><inlineCode parentName=\"strong\">{`perform`}</inlineCode>{` function`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`pub unsafe extern \"C\" fn perform(_env: napi_env, data: *mut c_void) {\n// getting the shared data and converting the in box\n    let mut t: Box<Data> = Box::from_raw(std::mem::transmute(data));\n    let mut last = 1;\n    let mut second_last = 0;\n    for _ in 2..t.val {\n        let temp = last;\n        last = last + second_last;\n        second_last = temp;\n    }\n// setting the result on shared context\n    t.result = Some(Ok(last));\n// telling the rust to not to drop the context data\n    Box::into_raw(t);\n}\n`}</code></pre>\n    <p><strong parentName=\"p\"><inlineCode parentName=\"strong\">{`complete`}</inlineCode>{` Function`}</strong></p>\n    <pre><code parentName=\"pre\" {...{}}>{`pub unsafe extern \"C\" fn complete(env: napi_env, _status: napi_status, data: *mut c_void) {\n// getting the shared context\n    let t: Box<Data> = Box::from_raw(std::mem::transmute(data));\n    let v = match task.result {\n        Some(d) => match d {\n            Ok(result) => result,\n            Err(_) => {\n// if there is error just throw an error\n// creating error\n                let mut js_error: napi_value = std::mem::zeroed();\n                napi_create_error(\n                    env,\n                    std::ptr::null_mut(),\n                    std::ptr::null_mut(),\n                    &mut js_error,\n                );\n// rejecting the promise with error\n                napi_reject_deferred(env, task.deferred, js_error);\n// deleting the task from the queue\n                napi_delete_async_work(env, task.work);\n                return;\n            }\n        },\n        None => {\n// if no result is found reject with error\n// creating an error\n            let mut js_error: napi_value = std::mem::zeroed();\n            napi_create_error(\n                env,\n                std::ptr::null_mut(),\n                std::ptr::null_mut(),\n                &mut js_error,\n            );\n// rejecting promise with error\n            napi_reject_deferred(env, task.deferred, js_error);\n// deleting the task from queue\n            napi_delete_async_work(env, task.work);\n            return;\n        }\n    };\n// creating the number\n    let mut obj: napi_value = std::mem::zeroed();\n    napi_create_int64(env, v as i64, &mut obj);\n// resolving the promise with result\n    napi_resolve_deferred(env, t.deferred, obj);\n// deleting the work\n    napi_delete_async_work(env, t.work);\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"conclusion\"\n    }}>{`Conclusion`}</h2>\n    <p>{`This is just the tip of the iceberg when it comes to what you can do with N-API. We went over a few patterns and covered the basics, such as how to export function, create oft-used JavaScript types such as strings, numbers, arrays, objects, etc., get the context of a function (i.e., get the arguments and `}<inlineCode parentName=\"p\">{`this`}</inlineCode>{` in a function), etc.`}</p>\n    <p>{`We also examined an in-depth example of how to use `}<inlineCode parentName=\"p\">{`libuv`}</inlineCode>{` threads and create an `}<inlineCode parentName=\"p\">{`async_work`}</inlineCode>{` to perform heavy calculations in the background. Finally, we created and used JavaScript's promises and learned how to do error handling in N-APIs.`}</p>\n    <p>{`There are many libraries available if you don’t want to write all the code by hand. These provide nice abstractions, but the downside is that they don't support all features.`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/neon-bindings/neon\"\n        }}>{`noen`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/infinyon/node-bindgen\"\n        }}>{`node-bindgen`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/Brooooooklyn/napi-rs\"\n        }}>{`napi-rs`}</a></li>\n    </ul>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\n  "]}]}